<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Средневековая RPG</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Google Fonts: Cinzel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">


    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="h-screen flex flex-col relative" style="overflow: hidden; -webkit-tap-highlight-color: transparent;">

    <!-- Background Pattern -->
    <div class="absolute inset-0 bg-pattern pointer-events-none"></div>

    <!-- Inline SVG Icon Sprite (Solid Style) -->
    <svg aria-hidden="true" style="position:absolute; width:0; height:0; overflow:hidden">
        <!-- Fishing rod (Solid) -->
        <symbol id="icon-rod" viewBox="0 0 512.01 512.01">
            <path fill="currentColor" d="M501.338,0c-2.954,0-5.624,1.201-7.555,3.138l-306.21,306.201l-7.537-7.536c-4.167-4.167-10.917-4.167-15.084,0
                L9.365,457.385c-12.48,12.479-12.48,32.771,0,45.25c6.042,6.042,14.084,9.375,22.626,9.375c8.563,0,16.605-3.333,22.647-9.375
                l94.929-94.939c1.275,34.177,29.28,61.637,63.764,61.637c35.293,0,64.002-28.708,64.002-64c0-2.568-0.253-52.451-18.031-100.676
                c7.673,2.77,15.442,4.499,23.281,4.499c19.938,0,40.126-8.948,59.127-26.802c20.521-19.302,31.834-42.813,31.834-66.198
                c0-9.033-1.938-17.672-5.259-25.875c29.661-1.863,65.583-22.423,87.262-44.073c13.625-13.615,25.688-31.437,35.126-50.917V480
                c0,5.885-4.792,10.667-10.667,10.667c-5.875,0-10.667-4.781-10.667-10.667v-42.667c0-4.313-2.604-8.208-6.583-9.854
                c-3.938-1.667-8.584-0.75-11.625,2.313l-10.667,10.667c-4.167,4.167-4.167,10.917,0,15.083c2.083,2.083,4.813,3.125,7.542,3.125
                V480c0,17.646,14.355,32,32.001,32s32.001-14.354,32.001-32V10.667C512.005,4.771,507.234,0,501.338,0z M232.033,295.056
                c9.19,19.033,14.909,39.885,18.392,58.316c-10.486-7.508-23.234-12.039-37.086-12.039c-0.124,0-0.238,0.035-0.362,0.036
                c0.595-3.319-0.197-6.835-2.763-9.401l-7.547-7.547L232.033,295.056z M39.568,487.552c-4.042,4.021-11.062,4.021-15.104,0
                c-4.167-4.156-4.167-10.927,0-15.083l148.042-148.042l15.083,15.083L39.568,487.552z M256.005,405.335
                c0,23.531-19.146,42.665-42.667,42.665c-23.521,0-42.667-19.135-42.667-42.667s19.146-42.667,42.667-42.667
                c23.521,0,42.667,19.134,42.667,42.665V405.335z M327.089,266.813c-25.967,24.419-51.576,27.504-76.273,9.461l90.527-90.527
                c7.138,9.128,10.871,19.294,10.871,30.41C352.214,233.344,343.047,251.802,327.089,266.813z M440.464,131.125
                c-22.458,22.448-56.5,39.438-77.563,38.198c-1.651-0.082-2.87-0.555-4.279-0.857L487.415,39.673
                C480.514,73.357,462.926,108.663,440.464,131.125z"/>
        </symbol>
        <!-- Sickle (Solid) -->
        <symbol id="icon-sickle" viewBox="0 0 512.001 512.001">
            <path fill="currentColor" d="M493.88,172.132c-11.966-27.852-29.753-54.467-53.123-77.837c-20.514-20.513-43.529-36.701-67.679-48.422
                c-24.152-11.72-49.443-18.984-74.56-21.615c-8.168-0.855-15.781,4.398-17.879,12.34c-2.098,7.941,1.925,16.268,9.45,19.561
                c20.029,8.765,39.283,21.197,56.228,38.138c17.17,17.168,30.153,36.558,38.812,56.47c8.665,19.911,12.982,40.328,12.977,59.482
                c0,14.302-2.392,27.887-7.089,40.181c-4.706,12.302-11.68,23.327-21.09,32.746c-9.419,9.41-20.444,16.384-32.745,21.09
                c-12.294,4.697-25.879,7.089-40.181,7.089c-19.154,0.006-39.571-4.313-59.482-12.977c-19.912-8.659-39.304-21.642-56.47-38.812
                c-6.52-6.52-17.09-6.52-23.61,0l-0.001,0.001l-16.982,16.982c-0.028,0.029-0.057,0.056-0.085,0.085L14.665,402.336
                c-5.003,4.998-8.718,10.862-11.122,17.011c-2.411,6.156-3.542,12.59-3.543,18.938c-0.003,12.884,5.23,25.454,14.665,34.881
                c4.856,4.858,10.537,8.554,16.577,11.001c6.043,2.45,12.444,3.668,18.838,3.668c6.394,0,12.795-1.219,18.838-3.668
                c6.04-2.446,11.721-6.141,16.577-11.001L193.241,365.42c20.266,17.818,42.526,31.774,65.645,41.707
                c27.853,11.961,56.96,18.117,85.367,18.122c22.37,0,44.319-3.831,64.749-11.721c20.423-7.882,39.315-19.856,55.365-35.914
                c16.058-16.051,28.032-34.943,35.914-55.366c7.89-20.43,11.721-42.379,11.721-64.749C511.998,229.092,505.842,199.987,493.88,172.132z"/>
        </symbol>
        <!-- Pickaxe (Solid) -->
        <symbol id="icon-pickaxe" viewBox="0 0 512 512">
            <path fill="currentColor" d="m510.367 288.035c-3.353-30.175-11.837-60.012-25.217-88.684-10.683-22.893-24.535-45.057-41.34-66.254l15.519-15.519c17.595-17.594 17.595-46.222.003-63.813l-1.105-1.105c-17.594-17.595-46.223-17.595-63.816 0l-15.519 15.519c-21.198-16.805-43.362-30.657-66.253-41.34-28.672-13.38-58.51-21.864-88.685-25.217-51.852-5.761-86.883 5.653-88.349 6.141-6.979 2.327-11.241 9.372-10.063 16.633 1.179 7.262 7.45 12.597 14.807 12.597.188 0 19.737.413 54.188 15.177 27.799 11.914 69.458 35.183 120.292 80.073l-301.624 301.62c-17.592 17.594-17.592 46.222.003 63.818l1.104 1.103c8.523 8.521 19.854 13.214 31.906 13.214 12.054 0 23.385-4.694 31.907-13.217l301.62-301.62c43.911 49.732 67.034 90.578 79.032 117.892 15.284 34.792 16.178 55.393 16.218 56.65-.091 7.375 5.199 13.604 12.477 14.846.832.142 1.661.21 2.481.21 6.376 0 12.199-4.154 14.273-10.376.488-1.465 11.902-36.5 6.141-88.348zm-140.883-145.531c-58.841-58.841-109.467-92.14-148.058-110.978.253.029.507.059.761.088 61.215 7.206 118.34 36.947 169.79 88.396 51.449 51.45 81.19 108.575 88.396 169.79.03.254.06.508.089.761-18.838-38.59-52.136-89.216-110.978-148.057zm46.139-68.632c2.949-2.949 6.823-4.423 10.696-4.423 3.872 0 7.745 1.474 10.691 4.421l1.105 1.105c5.897 5.897 5.897 15.493 0 21.39l-13.895 13.895c-3.575-3.858-7.25-7.681-11.031-11.462s-7.604-7.456-11.462-11.031zm-358.712 403.697c-2.855 2.856-6.653 4.429-10.693 4.429s-7.839-1.573-10.695-4.43c-.001-.001-.001-.002-.002-.002l-1.101-1.1c-5.897-5.897-5.897-15.494-.001-21.391l302.489-302.489c3.748 3.599 7.533 7.299 11.364 11.13 3.83 3.83 7.532 7.616 11.13 11.363z"/>
        </symbol>
        <!-- Crossbow (Solid) -->
        <symbol id="icon-crossbow" viewBox="0 0 512.001 512.001">
            <path fill="currentColor" d="M477.227,238.166h-0.256c-40.395-70.524-112.067-117.492-192.853-126.379l16.043-16.043 c5.137-5.156,6.439-13.003,3.243-19.541L270.806,8.534c-3.076-5.328-8.781-8.588-14.933-8.533 c-6.389-0.013-12.25,3.543-15.189,9.216l-32.427,66.987c-3.175,6.556-1.838,14.405,3.328,19.541l16.043,16.043 c-80.786,8.887-152.458,55.854-192.853,126.379c-18.851-0.212-34.305,14.898-34.517,33.749 c-0.212,18.851,14.898,34.305,33.749,34.517h8.533c2.335-0.006,4.66-0.322,6.912-0.939v0.768l146.688,33.365v44.373 c-0.13,0.763-0.13,1.542,0,2.304l17.067,60.928c1.988,7.682,9.148,12.872,17.067,12.373v35.328 c0,9.426,7.641,17.067,17.067,17.067h17.067c9.426,0,17.067-7.641,17.067-17.067v-35.328c7.605,0.09,14.293-5.014,16.213-12.373 l17.067-60.928c0.421-0.71,0.711-1.491,0.853-2.304v-44.373l146.944-33.365v-0.768c2.253,0.617,4.577,0.932,6.912,0.939h8.533 c18.851-0.212,33.961-15.666,33.749-34.517S496.078,237.954,477.227,238.166z M230.272,442.539l-17.067-59.733V281.601h17.067 V442.539z M230.272,264.534h-17.067c-9.426,0-17.067,7.641-17.067,17.067v40.533L65.323,292.353c0-0.597,0.597-1.109,0.853-1.707 c27.477-69.151,90.299-117.958,164.096-127.488V264.534z M298.539,382.806l-17.067,59.733V281.601h17.067V382.806z M315.606,322.134v-40.533c0-9.426-7.641-17.067-17.067-17.067h-17.067V163.158c73.761,9.617,136.544,58.394,164.096,127.488 c0,0.597,0.597,1.195,0.853,1.707L315.606,322.134z"/>
        </symbol>
        <!-- Leather (Solid) -->
        <symbol id="icon-leather" viewBox="0 0 467.473 467.473">
            <path fill="currentColor" d="m424.392,374.451c-26.765-30.588-42.326-69.803-43.816-110.419-1.49-40.617 11.154-80.866 35.605-113.334l5.488-7.288c2.328-3.091 2.663-7.249 0.861-10.673l-31.849-60.513c-1.729-3.286-5.136-5.343-8.849-5.343h-18.875c-28.06,0-53.333-16.665-64.386-42.456l-7.871-18.365c-1.575-3.676-5.19-6.06-9.19-6.06h-95.546c-4,0-7.616,2.384-9.191,6.061l-7.871,18.365c-11.053,25.791-36.327,42.456-64.386,42.456h-18.875c-3.713,0-7.12,2.057-8.849,5.343l-31.849,60.513c-1.802,3.424-1.467,7.582 0.861,10.673l5.488,7.288c24.451,32.468 37.096,72.717 35.605,113.334-1.49,40.617-17.051,79.831-43.816,110.419-2.784,3.182-3.266,7.772-1.204,11.463l30.256,54.143c2.148,3.844 6.56,5.829 10.861,4.892l12.05-2.629c46.118-10.062 93.472-1.681 133.336,23.599 1.635,1.037 3.495,1.555 5.355,1.555s3.721-0.519 5.355-1.555c39.864-25.28 87.216-33.66 133.336-23.599l12.05,2.629c4.303,0.939 8.713-1.047 10.861-4.892l30.256-54.143c2.065-3.692 1.583-8.282-1.201-11.464zm-42.894,49.377l-4.806-1.048c-49.248-10.746-99.763-2.582-142.955,22.967-30.778-18.206-65.269-27.583-100.374-27.583-14.161,0-28.427,1.527-42.582,4.615l-4.806,1.048-23.265-41.633c26.974-33.183 42.602-74.604 44.174-117.429 1.658-45.192-12.411-89.975-39.616-126.099l-1.675-2.224 26.085-49.561h12.837c36.071,0 68.56-21.423 82.769-54.577l5.274-12.304h82.358l5.273,12.305c14.209,33.154 46.698,54.577 82.769,54.577h12.837l26.085,49.561-1.675,2.224c-27.205,36.124-41.273,80.906-39.615,126.098 1.571,42.825 17.199,84.247 44.173,117.429l-23.265,41.634z"/>
            <path fill="currentColor" d="m382.256,140.073c2.035-3.048 2.239-6.965 0.532-10.209l-12.537-23.819c-1.707-3.243-5.05-5.292-8.714-5.341-40.083-0.541-76.666-24.483-93.199-60.998-1.62-3.577-5.183-5.875-9.11-5.875h-50.981c-3.927,0-7.49,2.298-9.11,5.875-16.534,36.514-53.117,60.457-93.2,60.998-3.664,0.049-7.008,2.099-8.714,5.342l-12.536,23.819c-1.707,3.243-1.503,7.16 0.532,10.208 24.5,36.709 37.104,81.173 35.489,125.199-1.489,40.571-14.573,79.688-37.837,113.122-2.185,3.14-2.387,7.25-0.521,10.59l7.273,13.015c2.044,3.657 6.153,5.653 10.291,4.999 10.926-1.727 22.06-2.603 33.092-2.603 33.308,0 66.57,7.982 96.191,23.083 1.427,0.727 2.984,1.091 4.542,1.091s3.115-0.364 4.542-1.091c29.619-15.101 62.882-23.083 96.191-23.083 11.032,0 22.166,0.875 33.092,2.603 4.136,0.651 8.246-1.342 10.291-5l7.272-13.015c1.866-3.339 1.664-7.45-0.521-10.589-23.264-33.434-36.347-72.551-37.836-113.122-1.618-44.026 10.985-88.489 35.486-125.199zm-18.516,246.18c-9.71-1.234-19.526-1.858-29.271-1.858-34.759,0-69.475,7.944-100.733,23.012-31.26-15.068-65.975-23.012-100.733-23.012-9.745,0-19.561,0.624-29.271,1.858l-.922-1.65c23.255-35.414 36.329-76.28 37.881-118.598 1.695-46.201-10.91-92.834-35.581-132.009l7.117-13.521c21.453-1.327 42.136-8.178 60.157-19.975 17.871-11.7 32.331-27.747 42.123-46.669h38.458c9.792,18.922 24.252,34.969 42.123,46.669 18.021,11.797 38.704,18.648 60.156,19.975l7.117,13.522c-24.671,39.175-37.276,85.809-35.581,132.008 1.553,42.318 14.626,83.185 37.881,118.598l-.921,1.65z"/>
            <path fill="currentColor" d="m233.74,84.185c2.63,0 5.21-1.07 7.07-2.93s2.93-4.44 2.93-7.07c0-2.63-1.07-5.21-2.93-7.07-1.86-1.87-4.44-2.93-7.07-2.93-2.64,0-5.21,1.06-7.07,2.93-1.87,1.86-2.93,4.44-2.93,7.07 0,2.63 1.06,5.21 2.93,7.07 1.86,1.86 4.43,2.93 7.07,2.93z"/>
            <path fill="currentColor" d="m287.734,196.177h-107.995c-5.523,0-10,4.477-10,10s4.477,10 10,10h107.995c5.523,0 10-4.477 10-10s-4.477-10-10-10z"/>
            <path fill="currentColor" d="m287.734,230.675h-107.995c-5.523,0-10,4.477-10,10s4.477,10 10,10h107.995c5.523,0 10-4.477 10-10s-4.477-10-10-10z"/>
            <path fill="currentColor" d="m287.734,265.174h-107.995c-5.523,0-10,4.477-10,10s4.477,10 10,10h107.995c5.523,0 10-4.477 10-10s-4.477-10-10-10z"/>
        </symbol>
        <!-- Cloth (Solid) - new -->
        <symbol id="icon-cloth" viewBox="0 0 512.001 512.001">
            <path fill="currentColor" d="M482.166,0H165.704c-16.445,0-29.825,14.191-29.825,31.635v48.212H96.837c-16.434,0-29.803,14.18-29.803,31.61v60.574H29.814c-16.434,0-29.804,13.29-29.804,29.627v280.714c0,16.337,13.37,29.629,29.804,29.629h316.112c16.434,0,29.803-13.291,29.803-29.629v-30.173h37.219c16.434,0,29.803-14.18,29.803-31.61V372.74h39.413c16.446,0,29.826-14.191,29.826-31.635V31.635C511.992,14.191,498.613,0,482.166,0z M355.654,482.372c0,5.266-4.364,9.552-9.726,9.552H29.814c-5.364,0-9.727-4.284-9.727-9.552V201.658c0-5.265,4.364-9.55,9.727-9.55h37.219v228.48c0,17.43,13.369,31.61,29.803,31.61h258.817V482.372z M422.676,420.589c0,6.359-4.364,11.533-9.726,11.533H96.837c-5.363,0-9.726-5.174-9.726-11.533V111.458c0-6.359,4.364-11.533,9.726-11.533h39.043v241.18c0,17.444,13.379,31.635,29.825,31.635h256.972V420.589z M491.915,341.105c0,6.373-4.373,11.558-9.748,11.558H165.704c-5.375,0-9.747-5.185-9.747-11.558V31.635c0-6.373,4.373-11.558,9.747-11.558h316.462c5.375,0,9.748,5.185,9.748,11.558V341.105z"/>
            <path fill="currentColor" d="M392.074,61.312H191.302c-5.541,0-10.039,4.497-10.039,10.039c0,5.532,4.497,10.039,10.039,10.039h200.771c5.531,0,10.028-4.506,10.029-10.039C402.101,65.81,397.605,61.312,392.074,61.312z"/>
            <path fill="currentColor" d="M433.592,100.102c-5.541,0-10.039,4.496-10.039,10.029V292.1c0,5.531,4.497,10.039,10.039,10.039c5.531,0,10.039-4.508,10.039-10.039V110.141C443.63,104.599,439.124,100.102,433.592,100.102z"/>
            <path fill="currentColor" d="M432.227,81.39c5.531,0,10.027-4.506,10.027-10.039c0-5.541-4.496-10.039-10.027-10.039c-5.542,0-10.039,4.497-10.039,10.039C422.188,76.883,426.684,81.39,432.227,81.39z"/>
        </symbol>
    </svg>

    <!-- Intro Modal (Arthur) -->
    <div id="modal-intro" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 relative overflow-hidden text-left">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#c8aa6e] to-transparent"></div>

            <div class="flex items-center gap-4 mb-4">
                <div class="w-14 h-14 rounded-full border-2 border-[#c8aa6e] bg-[#222] flex items-center justify-center overflow-hidden">
                    <i class="fas fa-user-tie text-2xl text-gray-300"></i>
                </div>
                <div>
                    <h2 class="medieval-font text-xl text-[#c8aa6e] leading-tight">Артур</h2>
                    <p class="text-[10px] text-[#777]">Травник</p>
                </div>
            </div>

            <div class="space-y-3 text-sm text-[#e0e0e0] leading-relaxed">
                <p>Очнулся наконец? Я нашёл тебя без сознания под мостом.</p>
                <p>Привёл в дом, обмыл, перевязал… и вылечил. Повезло тебе.</p>
                <p class="text-[#a0a0a0]">Совет на первое время: сходи на <span class="text-[#c8aa6e] font-bold">Городскую площадь</span> и попроси милостыню. Накопишь — купи <span class="text-[#c8aa6e] font-bold">удочку</span> на рынке. С неё и начнёшь вставать на ноги.</p>
            </div>

            <div class="mt-6 grid grid-cols-2 gap-2">
                <button onclick="game.closeIntro(false)" class="btn-medieval w-full py-2 rounded font-bold text-xs">
                    Понял
                </button>
                <button onclick="game.closeIntro(true)" class="btn-medieval w-full py-2 rounded font-bold text-xs">
                    На площадь
                </button>
            </div>
        </div>
    </div>

    <!-- Level Up Modal -->
    <div id="modal-levelup" class="modal-overlay">
        <div class="modal-content levelup-card rounded-lg p-6 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,rgba(200,170,110,0.15),transparent_55%)]"></div>
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#c8aa6e] to-transparent"></div>
            <div class="absolute inset-0 opacity-20 pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')]"></div>

            <div class="relative mb-4">
                <div class="levelup-glow absolute -inset-6 rounded-full bg-[#c8aa6e]/30 blur-3xl"></div>
                <i class="fas fa-crown text-5xl text-[#c8aa6e] drop-shadow-[0_0_15px_rgba(200,170,110,0.8)]"></i>
            </div>

            <h2 class="medieval-font text-2xl text-[#c8aa6e] mb-1 tracking-widest">УРОВЕНЬ ПОВЫШЕН</h2>
            <div id="levelup-new-level" class="text-5xl font-bold text-white mb-5 medieval-font drop-shadow-md">2</div>

            <div class="space-y-3 mb-6">
                <div class="bg-[#111]/80 border border-[#333] rounded p-3 flex items-center justify-between backdrop-blur-sm">
                    <span class="text-xs text-[#a0a0a0] uppercase tracking-wider">Награда</span>
                    <div class="flex items-center gap-2 text-[#ffd700] font-bold text-lg">
                        +<span id="levelup-gold">100</span> <i class="fas fa-coins"></i>
                    </div>
                </div>
                <div class="bg-[#111]/80 border border-[#333] rounded p-3 flex items-center justify-between backdrop-blur-sm">
                    <span class="text-xs text-[#a0a0a0] uppercase tracking-wider">Навыки</span>
                    <div class="text-[#34d399] font-bold text-lg">+1 Жетон</div>
                </div>
                <div class="text-left bg-[#222]/80 border-l-2 border-[#c8aa6e] rounded-r p-3 backdrop-blur-sm">
                    <div class="text-[10px] text-[#c8aa6e] font-bold mb-1 uppercase tracking-widest flex items-center gap-2">
                        <i class="fas fa-scroll"></i> Новые возможности
                    </div>
                    <p id="levelup-message" class="text-xs text-[#e0e0e0] leading-relaxed">...</p>
                </div>
            </div>

            <button onclick="game.closeLevelUp()" class="btn-medieval w-full py-3 rounded font-bold text-sm tracking-wider">ПРИНЯТЬ ДАРЫ</button>
        </div>
    </div>

    <!-- Daily Reward Modal -->
    <div id="modal-daily" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#c8aa6e] to-transparent"></div>
            <h2 class="medieval-font text-2xl text-[#c8aa6e] mb-2">Ежедневная Награда</h2>
            <p class="text-sm text-[#a0a0a0] mb-4">С возвращением, путник!</p>
            
            <div class="flex justify-center gap-2 mb-6">
                <div id="daily-days-container" class="flex gap-1"></div>
            </div>

            <div class="mb-6">
                <i class="far fa-gem text-4xl text-emerald-400 mb-2 drop-shadow-[0_0_10px_rgba(52,211,153,0.5)]"></i>
                <div class="text-xl font-bold text-white">+<span id="daily-amount">0</span> Изумрудов</div>
            </div>

            <button onclick="game.claimDaily()" class="btn-medieval w-full py-2 rounded font-bold">
                Забрать
            </button>
        </div>
    </div>

    <!-- Lost Pouch: Treasury -->
    <div id="modal-treasury-pouch" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden border-yellow-500">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-yellow-400 to-transparent"></div>
            <div class="absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_top,rgba(250,204,21,0.2),transparent_60%)]"></div>
            <div class="relative">
                <div class="w-16 h-16 rounded-full border border-yellow-400/60 bg-[#111] flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-sack-dollar text-3xl text-yellow-400"></i>
                </div>
                <h2 class="medieval-font text-2xl text-yellow-300 mb-2">Чужой кошель</h2>
                <p class="text-sm text-[#a0a0a0] mb-4">У входа в казну выпал мешочек с <span class="text-yellow-300 font-bold">1000 золота</span>.</p>
                <div class="panel p-3 rounded bg-black/40 border border-[#333] mb-4 text-left">
                    <div class="text-[10px] text-[#c8aa6e] uppercase tracking-widest mb-1">Выбор</div>
                    <p class="text-xs text-[#e0e0e0] leading-relaxed">Ты можешь позвать владельца и вернуть мешок — или забрать себе.</p>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="ui.resolveTreasuryPouch('return')" class="btn-medieval w-full py-2 rounded text-xs border-emerald-500 text-emerald-300">
                        Вернуть (+3 Реп.)
                    </button>
                    <button onclick="ui.resolveTreasuryPouch('keep')" class="btn-medieval w-full py-2 rounded text-xs border-red-500 text-red-300">
                        Забрать (-5 Реп.)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lost Pouch: Bookhouse -->
    <div id="modal-bookhouse-pouch" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden border-emerald-500">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-emerald-400 to-transparent"></div>
            <div class="absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_top,rgba(52,211,153,0.2),transparent_60%)]"></div>
            <div class="relative">
                <div class="w-16 h-16 rounded-full border border-emerald-500/60 bg-[#111] flex items-center justify-center mx-auto mb-4">
                    <i class="far fa-gem text-3xl text-emerald-400"></i>
                </div>
                <h2 class="medieval-font text-2xl text-emerald-300 mb-2">Забытая шкатулка</h2>
                <p class="text-sm text-[#a0a0a0] mb-4">Между полками лежит шкатулка с <span class="text-emerald-300 font-bold">10 изумрудами</span>.</p>
                <div class="panel p-3 rounded bg-black/40 border border-[#333] mb-4 text-left">
                    <div class="text-[10px] text-[#c8aa6e] uppercase tracking-widest mb-1">Совесть</div>
                    <p class="text-xs text-[#e0e0e0] leading-relaxed">Вернёшь владельцу — заслужишь уважение. Оставишь — легко разбогатеешь.</p>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="ui.resolveBookhousePouch('return')" class="btn-medieval w-full py-2 rounded text-xs border-emerald-500 text-emerald-300">
                        Вернуть (+3 Реп.)
                    </button>
                    <button onclick="ui.resolveBookhousePouch('keep')" class="btn-medieval w-full py-2 rounded text-xs border-red-500 text-red-300">
                        Забрать (-5 Реп.)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Unconscious Modal -->
    <div id="modal-unconscious" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden border-red-500">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-500 to-transparent"></div>
            <div class="absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_top,rgba(239,68,68,0.2),transparent_60%)]"></div>
            <div class="relative">
                <div class="w-16 h-16 rounded-full border border-red-500/60 bg-[#111] flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-skull-crossbones text-3xl text-red-400"></i>
                </div>
                <h2 class="medieval-font text-2xl text-red-400 mb-2">Потеря сознания</h2>
                <p class="text-sm text-[#a0a0a0] mb-4">Вы лишились сил. Мир меркнет...</p>
                <div class="panel p-3 rounded bg-black/40 border border-[#333] mb-4">
                    <div class="text-[10px] text-[#777] uppercase tracking-widest mb-1">До пробуждения</div>
                    <div id="unconscious-timer" class="text-2xl font-bold text-[#c8aa6e] medieval-font">10:00</div>
                </div>
                <p class="text-[10px] text-[#777]">После пробуждения здоровье восстановится до 15 HP.</p>
            </div>
        </div>
    </div>

    <!-- Low HP Warning Modal -->
    <div id="modal-lowhp" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden border-amber-500">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-400 to-transparent"></div>
            <div class="absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_top,rgba(251,191,36,0.2),transparent_60%)]"></div>
            <div class="relative">
                <div class="w-16 h-16 rounded-full border border-amber-500/60 bg-[#111] flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-triangle-exclamation text-3xl text-amber-400"></i>
                </div>
                <h2 class="medieval-font text-2xl text-amber-300 mb-2">Слишком слаб</h2>
                <p class="text-sm text-[#a0a0a0] mb-4">Ты можешь потерять сознание. Сил осталось совсем мало.</p>
                <div class="panel p-3 rounded bg-black/40 border border-[#333] mb-4 text-left">
                    <div class="text-[10px] text-[#c8aa6e] uppercase tracking-widest mb-1">Совет</div>
                    <p class="text-xs text-[#e0e0e0] leading-relaxed">Посети лекаря в хижине или съешь еду, чтобы восстановить здоровье.</p>
                </div>
                <button onclick="ui.dismissLowHpWarning()" class="btn-medieval w-full py-2 rounded text-xs border-amber-500 text-amber-300">
                    Понял
                </button>
            </div>
        </div>
    </div>

    <!-- Hunger Warning Modal -->
    <div id="modal-hunger" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden border-orange-500">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-orange-400 to-transparent"></div>
            <div class="absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_top,rgba(251,146,60,0.2),transparent_60%)]"></div>
            <div class="relative">
                <div class="w-16 h-16 rounded-full border border-orange-500/60 bg-[#111] flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-utensils text-3xl text-orange-400"></i>
                </div>
                <h2 class="medieval-font text-2xl text-orange-300 mb-2">Сильный голод</h2>
                <p class="text-sm text-[#a0a0a0] mb-4">Ваш персонаж очень голоден! Теперь вы будете получать в два раза больше урона.</p>
                <div class="panel p-3 rounded bg-black/40 border border-[#333] mb-4 text-left">
                    <div class="text-[10px] text-[#c8aa6e] uppercase tracking-widest mb-1">Совет</div>
                    <p class="text-xs text-[#e0e0e0] leading-relaxed">Приготовьте еду, поешьте в таверне или в другом месте, чтобы восстановить сытость.</p>
                </div>
                <button onclick="ui.dismissHungerWarning()" class="btn-medieval w-full py-2 rounded text-xs border-orange-500 text-orange-300">
                    Понял
                </button>
            </div>
        </div>
    </div>

    <!-- Reputation Info Modal -->
    <div id="modal-reputation" class="modal-overlay">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#c8aa6e] to-transparent"></div>
            <h2 class="medieval-font text-2xl text-[#c8aa6e] mb-2">Репутация</h2>
            <p class="text-sm text-[#a0a0a0] mb-4">То, как тебя видят жители города.</p>
            <div class="panel p-3 rounded bg-black/30 border border-[#333] text-left text-xs text-[#e0e0e0] space-y-2">
                <p><span class="text-[#c8aa6e] font-bold">Повышается</span> за добрые поступки, выполнение заданий, покупку хорошей одежды, оружия и приличного дома.</p>
                <p><span class="text-red-400 font-bold">Понижается</span> за грубость, обман и сомнительные дела.</p>
                <p class="text-[10px] text-[#777]">Совет: будь вежливым, носи чистую одежду и обзаведись достойным домом.</p>
            </div>
            <button onclick="ui.closeRepInfo()" class="btn-medieval w-full py-2 rounded font-bold mt-4">Понял</button>
        </div>
    </div>

    <!-- Item Info Modal -->
    <div id="modal-item" class="modal-overlay" onclick="itemModal.close()">
        <div class="modal-content rounded-lg p-6 text-center relative overflow-hidden" onclick="event.stopPropagation()">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#c8aa6e] to-transparent"></div>

            <div class="w-16 h-16 rounded-full border border-[#c8aa6e]/70 bg-[#111] flex items-center justify-center mx-auto mb-3">
                <i id="item-modal-icon" class="fas fa-question text-3xl text-[#c8aa6e]"></i>
            </div>

            <h2 id="item-modal-name" class="medieval-font text-xl text-[#c8aa6e] mb-1">Предмет</h2>
            <div id="item-modal-count" class="text-[10px] text-[#777] mb-3"></div>

            <div class="panel p-3 rounded bg-black/30 border border-[#333] text-left">
                <div class="text-[10px] text-[#c8aa6e] uppercase tracking-widest mb-1">Описание</div>
                <p id="item-modal-desc" class="text-xs text-[#e0e0e0] leading-relaxed">—</p>
                <div class="mt-3 flex items-center justify-between text-[10px] text-[#a0a0a0]">
                    <span>Вес</span>
                    <span id="item-modal-weight" class="text-[#c8aa6e] font-bold">0 кг</span>
                </div>
            </div>

            <button onclick="itemModal.close()" class="btn-medieval w-full py-2 rounded font-bold mt-4">Закрыть</button>
        </div>
    </div>

    <!-- Dialogue Modal -->
    <div id="modal-dialogue" class="modal-overlay">
        <div class="modal-content rounded-lg p-0 relative overflow-hidden text-left flex flex-col max-h-[80vh]">
            <!-- NPC Header -->
            <div class="bg-[#111] p-4 flex items-center gap-4 border-b border-[#333]">
                <div class="w-12 h-12 rounded-full border border-[#c8aa6e] bg-[#222] flex items-center justify-center overflow-hidden shrink-0">
                    <i id="npc-icon" class="fas fa-user text-xl text-gray-300"></i>
                </div>
                <div>
                    <h2 id="npc-name" class="medieval-font text-lg text-[#c8aa6e] leading-tight">Имя</h2>
                    <p id="npc-role" class="text-[10px] text-[#777]">Роль</p>
                </div>
                <button onclick="dialogue.close()" class="ml-auto text-gray-500 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Chat Body -->
            <div class="p-4 overflow-y-auto bg-[#1a1a1d] min-h-[150px]">
                <p id="npc-text" class="text-sm text-[#e0e0e0] leading-relaxed">...</p>
            </div>

            <!-- Options -->
            <div id="npc-options" class="p-2 bg-[#111] border-t border-[#333] flex flex-col gap-2">
                <!-- Options populated by JS -->
            </div>
        </div>
    </div>

    <!-- Header / Currency Bar -->
    <header class="h-14 flex items-center justify-between px-4 bg-opacity-90 bg-[#141417] border-b border-[#333] z-20 backdrop-blur-md shrink-0">
        <div class="flex items-center gap-3">
            <div class="flex items-center gap-1">
                <i class="fas fa-coins text-yellow-500 text-sm"></i>
                <span id="gold-display" class="font-bold tracking-wide text-sm">0</span>
            </div>
            <div class="flex items-center gap-1">
                <i class="far fa-gem text-emerald-400 text-sm"></i>
                <span id="emerald-display" class="font-bold tracking-wide text-sm">0</span>
            </div>
        </div>
        
        <!-- Header Level & XP -->
        <div class="flex flex-col items-end justify-center w-32">
             <div class="flex items-center justify-between w-full mb-0.5">
                <span class="text-[10px] text-[#a0a0a0] flex items-center gap-1"><i class="fas fa-heart text-red-500"></i> <span id="header-hp-text">100</span></span>
                <span class="text-xs text-[#c8aa6e] font-serif font-bold" id="level-display-header">Ур 1</span>
             </div>
             <div class="w-full h-1.5 bg-[#000] rounded-full overflow-hidden border border-[#333] mb-0.5">
                 <div id="header-xp-bar" class="h-full bg-gradient-to-r from-[#8b733d] to-[#c8aa6e] w-0 transition-all duration-300"></div>
             </div>
             <div class="text-[8px] text-[#777] font-mono tracking-tighter" id="header-xp-text">0/100</div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-container" class="flex-1 overflow-y-auto p-4 pb-20 relative">
        
        <!-- VIEW: CHARACTER -->
        <section id="view-character" class="space-y-6 hidden">
            <div class="flex flex-col items-center justify-center py-6 relative">
                <!-- Hero quick actions -->
                <div class="absolute top-0 right-0 flex gap-2">
                    <button onclick="ui.openSettings()" class="icon-tile" aria-label="Настройки">
                        <i class="fas fa-gear"></i>
                    </button>
                </div>

                <div class="w-32 h-32 rounded-full border-2 border-[#c8aa6e] overflow-hidden shadow-[0_0_15px_rgba(200,170,110,0.3)] mb-4 relative bg-[#222]" style="box-shadow: inset 0 0 20px rgba(0,0,0,0.5), 0 0 15px rgba(200,170,110,0.3);">
                    <img src="https://i.postimg.cc/L5B41FgX/IMG-4572.jpg" alt="Герой" class="w-full h-full object-cover scale-110" onerror="this.onerror=null; this.src='https://api.dicebear.com/7.x/adventurer/svg?seed=medievalWarrior&backgroundColor=1a1a1d&skinColor=f2d3b1&hair=short01&hairColor=796a45&eyes=variant01&eyebrows=variant10&mouth=variant01';">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[#c8aa6e]/30 pointer-events-none"></div>
                    <div class="absolute inset-0 border-4 border-[#c8aa6e]/30 rounded-full pointer-events-none"></div>
                </div>
                <h2 class="text-2xl medieval-font text-[#e0e0e0]">Странник</h2>
                <p class="text-sm text-[#a0a0a0] mb-2">Начинающий искатель приключений</p>
                <div class="panel rounded p-2 text-center text-[10px] text-[#a0a0a0] w-full max-w-xs mb-2">
                    <div class="flex items-center justify-center gap-2">
                        <span>Имя:</span>
                        <span id="player-name" class="text-[#c8aa6e] font-bold">Странник</span>
                    </div>
                    <div class="mt-1">ID: <span id="player-id" class="text-[#c8aa6e] font-bold">—</span></div>
                </div>
                
                <!-- Level Progress -->
                <div class="w-full max-w-xs space-y-1">
                    <div class="flex justify-between text-xs text-[#a0a0a0]">
                        <span>Уровень <span id="char-level">1</span></span>
                    </div>
                    <div class="progress-container">
                        <div id="xp-bar" class="progress-fill"></div>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <div class="text-[10px] text-[#777]">
                             <span id="xp-text">0 / 100 XP</span>
                        </div>
                        <div class="text-[10px] text-[#777]">
                            Осталось <span id="xp-remaining" class="text-[#c8aa6e]">100</span>
                        </div>
                    </div>
                </div>

                <!-- HP Status -->
                <div class="w-full max-w-xs mt-2">
                    <div class="flex justify-between text-xs text-[#a0a0a0] mb-1">
                        <span>Здоровье</span>
                        <span id="hp-text" class="text-red-400">100 / 100</span>
                    </div>
                    <div class="h-2 bg-[#000] border border-[#333] rounded-full overflow-hidden relative">
                        <div id="hp-bar" class="h-full bg-red-600 w-full transition-all duration-300"></div>
                    </div>
                </div>

                <!-- Hunger Status -->
                <div class="w-full max-w-xs mt-2">
                    <div class="flex justify-between text-xs text-[#a0a0a0] mb-1">
                        <span>Голод</span>
                        <span id="hunger-text" class="text-amber-400">100 / 100</span>
                    </div>
                    <div class="h-2 bg-[#000] border border-[#333] rounded-full overflow-hidden relative">
                        <div id="hunger-bar" class="h-full bg-amber-500 w-full transition-all duration-300"></div>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-3 gap-3">
                <div class="panel p-3 rounded text-center">
                    <div class="text-[10px] text-[#a0a0a0] uppercase tracking-widest">Урон</div>
                    <div id="stat-damage" class="text-lg font-bold text-[#c8aa6e]">0</div>
                </div>
                <div class="panel p-3 rounded text-center">
                    <div class="text-[10px] text-[#a0a0a0] uppercase tracking-widest">Ловкость</div>
                    <div id="stat-agility" class="text-lg font-bold text-[#c8aa6e]">0</div>
                </div>
                <div class="panel p-3 rounded text-center">
                    <div class="text-[10px] text-[#a0a0a0] uppercase tracking-widest">Удача</div>
                    <div id="stat-luck" class="text-lg font-bold text-[#c8aa6e]">0</div>
                </div>
            </div>

            <div class="panel rounded p-3 cursor-pointer" onclick="ui.openRepInfo()">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2 text-xs text-[#a0a0a0] uppercase tracking-widest">
                        <i class="fas fa-scale-balanced text-[#c8aa6e]"></i>
                        Репутация
                    </div>
                    <div class="text-sm font-bold text-[#c8aa6e]"><span id="rep-value">0</span>/100</div>
                </div>
                <div class="h-2 bg-[#000] border border-[#333] rounded-full overflow-hidden">
                    <div id="rep-bar" class="h-full bg-gradient-to-r from-emerald-700 to-[#c8aa6e] w-0 transition-all duration-300"></div>
                </div>
                <div id="rep-rank" class="text-[10px] text-[#777] mt-2">Безымянный странник</div>
            </div>
            
            <!-- Active Effects Display -->
            <div id="active-effects-container" class="grid grid-cols-2 gap-2 hidden">
                <div id="effect-immortality" class="panel p-2 rounded flex items-center gap-2 border-red-500/50 hidden">
                    <i class="fas fa-heart text-red-500 animate-pulse"></i>
                    <div>
                        <div class="text-[10px] text-red-400 font-bold uppercase">Бессмертие</div>
                        <div class="text-[10px] text-gray-400" id="timer-immortality">00:00</div>
                    </div>
                </div>
                <div id="effect-luck" class="panel p-2 rounded flex items-center gap-2 border-green-500/50 hidden">
                    <i class="fas fa-clover text-green-500 animate-pulse"></i>
                    <div>
                        <div class="text-[10px] text-green-400 font-bold uppercase">Удача x2</div>
                        <div class="text-[10px] text-gray-400" id="timer-luck">00:00</div>
                    </div>
                </div>
            </div>

             <!-- Integrated Inventory & Crafting & Skills -->
             <div class="panel rounded p-4">
                <div class="flex gap-2 mb-4">
                    <button onclick="ui.switchCharTab('inventory')" id="btn-tab-inv" class="flex-1 bg-[#2c2c30] border border-[#c8aa6e] text-[#c8aa6e] py-1 rounded text-xs uppercase font-serif transition-colors">Инвентарь</button>
                    <button onclick="ui.switchCharTab('skills')" id="btn-tab-skills" class="flex-1 bg-[#1a1a1d] border border-[#333] text-[#777] py-1 rounded text-xs uppercase font-serif transition-colors">Навыки</button>
                </div>
                
                <!-- Inventory UI -->
                <div id="ui-inventory">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="medieval-font text-sm text-[#c8aa6e]">Рюкзак</h3>
                        <button onclick="crafting.toggleMode()" class="text-[10px] text-[#777] underline">
                            <i class="fas fa-hammer mr-1"></i> <span id="craft-btn-text">Перейти к крафту</span>
                        </button>
                    </div>
                    <!-- Inventory Tabs -->
                    <div class="flex items-center gap-2 overflow-x-auto pb-2 mb-2 no-scrollbar">
                        <button onclick="inventory.switchCategory('tools')" id="tab-inv-tools" class="sub-tab active">Инструменты</button>
                        <button onclick="inventory.switchCategory('weapons')" id="tab-inv-weapons" class="sub-tab">Меч</button>
                        <button onclick="inventory.switchCategory('armor')" id="tab-inv-armor" class="sub-tab">Броня</button>
                        <button onclick="inventory.switchCategory('potions')" id="tab-inv-potions" class="sub-tab">Зелья</button>
                        <button onclick="inventory.switchCategory('other')" id="tab-inv-other" class="sub-tab">Другое</button>
                    </div>

                    <div id="inventory-grid" class="grid grid-cols-4 gap-2">
                        <!-- Slots populated by JS -->
                    </div>
                    <div class="mt-2">
                        <div class="flex items-center justify-between text-[10px] text-[#a0a0a0] mb-1">
                            <span>Нагрузка</span>
                            <span id="weight-text" class="text-[#c8aa6e] font-bold">0 / 50 кг</span>
                        </div>
                        <div class="h-1.5 bg-[#000] border border-[#333] rounded-full overflow-hidden">
                            <div id="weight-bar" class="h-full bg-gradient-to-r from-emerald-700 to-[#c8aa6e] w-0 transition-all duration-300"></div>
                        </div>
                    </div>
                    <p class="text-[10px] text-[#777] mt-2">Вместимость рюкзака можно улучшать через крафт (рецепт продается в Книжном Доме).</p>
                </div>

                <!-- Crafting UI -->
                <div id="ui-crafting" class="hidden">
                     <!-- Crafting Tabs -->
                     <div class="flex items-center gap-2 overflow-x-auto pb-2 mb-2 no-scrollbar">
                        <button onclick="crafting.switchCategory('potions')" id="tab-craft-potions" class="sub-tab active">Зелья</button>
                        <button onclick="crafting.switchCategory('charms')" id="tab-craft-charms" class="sub-tab">Обереги</button>
                        <button onclick="crafting.switchCategory('tools')" id="tab-craft-tools" class="sub-tab">Материалы</button>
                        <button onclick="crafting.switchCategory('food')" id="tab-craft-food" class="sub-tab">Еда</button>
                    </div>

                    <div id="crafting-list" class="space-y-3">
                        <!-- Recipes populated by JS -->
                        <div class="text-center text-xs text-gray-500 py-4">Нет рецептов</div>
                    </div>
                </div>

                <!-- Skills UI -->
                <div id="ui-skills" class="hidden space-y-3">
                    <div class="flex justify-between items-center p-2 bg-black/20 rounded border border-[#333]">
                        <span class="text-sm text-[#a0a0a0]"><i class="fas fa-star text-yellow-500 mr-1"></i> Жетоны навыков</span>
                        <span class="text-xl font-bold text-[#c8aa6e]" id="skill-points-display">0</span>
                    </div>

                    <div class="panel p-3 rounded flex justify-between items-center bg-[#151518]">
                        <div>
                            <div class="text-[#e0e0e0] font-bold text-xs"><i class="fas fa-suitcase text-yellow-500 mr-1"></i> Рюкзак (Ур <span id="bag-level-display">0</span>)</div>
                            <div class="text-[10px] text-[#777]">+8 слотов к инвентарю</div>
                        </div>
                        <button onclick="crafting.upgradeBag(event)" class="bg-[#222] border border-[#c8aa6e] text-[#c8aa6e] px-3 py-1 text-[10px] rounded hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">
                            Улучшить
                        </button>
                    </div>

                    <!-- Max HP -->
                    <div class="panel p-3 rounded flex justify-between items-center bg-[#151518]">
                        <div>
                            <div class="text-[#e0e0e0] font-bold text-xs"><i class="fas fa-heart text-red-500 mr-1"></i> Живучесть</div>
                            <div class="text-[10px] text-[#777]">+20 Макс. здоровья</div>
                        </div>
                        <button onclick="skills.upgrade('hp')" class="bg-[#222] border border-[#c8aa6e] text-[#c8aa6e] px-3 py-1 text-[10px] rounded hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">
                            1 Жетон
                        </button>
                    </div>
                    
                    <!-- Luck -->
                    <div class="panel p-3 rounded flex justify-between items-center bg-[#151518]">
                        <div>
                            <div class="text-[#e0e0e0] font-bold text-xs"><i class="fas fa-clover text-green-500 mr-1"></i> Удача (Ур <span id="luck-display">0</span>)</div>
                            <div class="text-[10px] text-[#777]">Больше шансов на добычу</div>
                        </div>
                        <button onclick="skills.upgrade('luck')" class="bg-[#222] border border-[#c8aa6e] text-[#c8aa6e] px-3 py-1 text-[10px] rounded hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">
                            1 Жетон
                        </button>
                    </div>

                     <!-- Agility -->
                    <div class="panel p-3 rounded flex justify-between items-center bg-[#151518]">
                        <div>
                            <div class="text-[#e0e0e0] font-bold text-xs"><i class="fas fa-person-running text-blue-400 mr-1"></i> Ловкость (Ур <span id="agility-display">0</span>)</div>
                            <div class="text-[10px] text-[#777]">Меньше шанс травмы</div>
                        </div>
                        <button onclick="skills.upgrade('agility')" class="bg-[#222] border border-[#c8aa6e] text-[#c8aa6e] px-3 py-1 text-[10px] rounded hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">
                            1 Жетон
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: MAP -->
        <section id="view-map" class="space-y-4">
            <h2 class="medieval-font text-2xl text-center mb-6 text-[#c8aa6e]">Карта Мира</h2>
            
            <div class="space-y-4">
                <div class="flex items-center gap-2 text-[11px] text-[#c8aa6e] uppercase tracking-[0.3em]">
                    <i class="fas fa-city"></i>
                    Город
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <!-- Jobs -->
                    <button onclick="router.navigate('jobs')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-[#0b2a55]/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/zvrrJHQg/IMG-4559.jpg"
                          alt="Работы"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(30,144,255,0.18),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-[#1E90FF]/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-[#7fb7ff]/70 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-[#0e3a6b]/70 to-[#0b2a55] flex items-center justify-center border-2 border-[#1E90FF]/60 shadow-[0_0_20px_rgba(30,144,255,0.35)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-hammer text-[#1E90FF] text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-[#dbeafe] drop-shadow-lg text-center">Работы</h3>
                            <p class="text-[9px] text-[#90c2ff]/70 text-center mt-0.5">Порт, Поле, Шахта</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#1E90FF]/50 to-transparent"></div>
                    </button>

                    <!-- Town Square -->
                    <button onclick="router.navigate('town-square')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-[#3b1f0b]/85 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/BnPztnfV/IMG-4542.jpg"
                          alt="Городская площадь"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1697730268732-1bb29e0bb8f6?w=1200&q=85';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(139,69,19,0.2),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-[#8B4513]/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-[#d2a679]/70 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-[#5a2d0f]/70 to-[#3b1f0b] flex items-center justify-center border-2 border-[#8B4513]/60 shadow-[0_0_20px_rgba(139,69,19,0.35)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-landmark text-[#c47a2c] text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-[#f5e1c9] drop-shadow-lg text-center">Городская площадь</h3>
                            <p class="text-[9px] text-[#cfa57a]/70 text-center mt-0.5">Милостыня, слухи</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#8B4513]/50 to-transparent"></div>
                    </button>

                    <!-- Tavern -->
                    <button onclick="router.navigate('tavern')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-orange-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/kGckq181/IMG-4560.jpg"
                          alt="Таверна"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(249,115,22,0.15),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-orange-600/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-orange-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-orange-900/60 to-orange-950 flex items-center justify-center border-2 border-orange-500/60 shadow-[0_0_20px_rgba(249,115,22,0.3)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-beer-mug-empty text-orange-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-orange-100 drop-shadow-lg text-center">Таверна</h3>
                            <p class="text-[9px] text-orange-300/60 text-center mt-0.5">Отдых и игры</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-orange-500/40 to-transparent"></div>
                    </button>

                    <!-- Treasury -->
                    <button onclick="router.navigate('treasury')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-yellow-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/hvS5yLws/IMG-4561.jpg"
                          alt="Казна"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(234,179,8,0.15),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-yellow-600/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-yellow-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-yellow-900/60 to-yellow-950 flex items-center justify-center border-2 border-yellow-500/60 shadow-[0_0_20px_rgba(234,179,8,0.3)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-coins text-yellow-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-yellow-100 drop-shadow-lg text-center">Казна</h3>
                            <p class="text-[9px] text-yellow-300/60 text-center mt-0.5">Обмен, хранилище</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-500/40 to-transparent"></div>
                    </button>

                    <!-- Healer's Hut -->
                    <button onclick="router.navigate('healer')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-red-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/rpXgZGRd/IMG-4564.jpg"
                          alt="Хижина лекаря"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(239,68,68,0.15),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-red-600/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-red-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-red-900/60 to-red-950 flex items-center justify-center border-2 border-red-500/60 shadow-[0_0_20px_rgba(239,68,68,0.3)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-mortar-pestle text-red-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-red-100 drop-shadow-lg text-center">Хижина Лекаря</h3>
                            <p class="text-[9px] text-red-300/60 text-center mt-0.5">Лечение и зелья</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-red-500/40 to-transparent"></div>
                    </button>

                    <!-- Royal Castle -->
                    <button onclick="router.navigate('royal-castle')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-indigo-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/JnqyJXkK/IMG-4567.jpg"
                          alt="Королевский замок"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(99,102,241,0.15),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-indigo-600/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-indigo-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-indigo-900/60 to-indigo-950 flex items-center justify-center border-2 border-indigo-500/60 shadow-[0_0_20px_rgba(99,102,241,0.3)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-chess-rook text-indigo-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-indigo-100 drop-shadow-lg text-center">Королевский замок</h3>
                            <p class="text-[9px] text-indigo-300/60 text-center mt-0.5">Для знати</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-indigo-500/40 to-transparent"></div>
                    </button>

                    <!-- Noble Quarter -->
                    <button onclick="router.navigate('noble-quarter')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-yellow-900/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/hv51LVqc/IMG-4565.jpg"
                          alt="Дворянский квартал"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(202,138,4,0.15),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-yellow-600/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-yellow-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-yellow-800/60 to-yellow-950 flex items-center justify-center border-2 border-yellow-500/60 shadow-[0_0_20px_rgba(202,138,4,0.3)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-crown text-yellow-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-yellow-100 drop-shadow-lg text-center">Дворянский квартал</h3>
                            <p class="text-[9px] text-yellow-300/60 text-center mt-0.5">Роскошь и власть</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-500/40 to-transparent"></div>
                    </button>

                    <!-- Poor District -->
                    <button onclick="router.navigate('poor-district')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-stone-900/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/B6hT32bL/IMG-4566.jpg"
                          alt="Район для бедняков"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(120,113,108,0.1),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-stone-600/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-stone-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-stone-800/60 to-stone-950 flex items-center justify-center border-2 border-stone-600/60 shadow-[0_0_20px_rgba(120,113,108,0.2)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-house-crack text-stone-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-stone-200 drop-shadow-lg text-center">Район для бедняков</h3>
                            <p class="text-[9px] text-stone-400/60 text-center mt-0.5">Грязные улицы</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-stone-600/40 to-transparent"></div>
                    </button>
                </div>

                <div class="flex items-center gap-2 text-[11px] text-[#c8aa6e] uppercase tracking-[0.3em] pt-2">
                    <i class="fas fa-mountain"></i>
                    Предместье
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <!-- Village -->
                    <button id="btn-loc-village" onclick="router.navigate('village')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-[#0b2b17]/85 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/P5BFss9w/IMG-4562.jpg"
                          alt="Деревня"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(0,128,0,0.2),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-[#008000]/20 flex items-center justify-center">
                            <i id="village-lock-icon" class="fas fa-chevron-right text-[#7ad37a]/70 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-[#0f4a26]/70 to-[#0b2b17] flex items-center justify-center border-2 border-[#008000]/60 shadow-[0_0_20px_rgba(0,128,0,0.35)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-house-chimney text-[#3ddc84] text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-[#def7de] drop-shadow-lg text-center">Деревня на окраине</h3>
                            <p id="village-desc" class="text-[9px] text-[#9fe0a1]/70 text-center mt-0.5">Дом и хозяйство</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#008000]/50 to-transparent"></div>
                    </button>

                    <!-- Livestock Trader -->
                    <button id="btn-loc-livestock" onclick="router.navigate('livestock-trader')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-emerald-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/zvw13wHX/IMG-4569.jpg"
                          alt="Торговец скотом"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(16,185,129,0.18),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-emerald-600/20 flex items-center justify-center">
                            <i class="fas fa-chevron-right text-emerald-500/70 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-emerald-900/60 to-emerald-950 flex items-center justify-center border-2 border-emerald-500/60 shadow-[0_0_20px_rgba(16,185,129,0.35)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-cow text-emerald-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-emerald-100 drop-shadow-lg text-center">Торговец скотом</h3>
                            <p class="text-[9px] text-emerald-300/60 text-center mt-0.5">Животные и корм</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-emerald-500/40 to-transparent"></div>
                    </button>

                    <!-- Refugee Camp -->
                    <button id="btn-loc-refugee" onclick="router.navigate('refugee-camp')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-slate-900/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/d3CV6T7L/IMG-4568.jpg"
                          alt="Лагерь беженцев"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(100,116,139,0.1),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-slate-600/20 flex items-center justify-center">
                            <i id="refugee-lock-icon" class="fas fa-lock text-slate-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-slate-800/60 to-slate-950 flex items-center justify-center border-2 border-slate-600/60 shadow-[0_0_20px_rgba(100,116,139,0.2)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-campground text-slate-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-slate-300 drop-shadow-lg text-center">Лагерь беженцев</h3>
                            <p id="refugee-desc" class="text-[9px] text-slate-500 text-center mt-0.5">Тайное место</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-slate-600/40 to-transparent"></div>
                    </button>

                    <!-- Dark Forest -->
                    <button id="btn-loc-forest" onclick="router.navigate('dark-forest')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-purple-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/kGXTFn6F/IMG-4563.jpg"
                          alt="Тёмный лес"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(168,85,247,0.15),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-purple-600/20 flex items-center justify-center">
                            <i id="forest-lock-icon" class="fas fa-chevron-right text-purple-500/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-purple-900/60 to-purple-950 flex items-center justify-center border-2 border-purple-500/60 shadow-[0_0_20px_rgba(168,85,247,0.4)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-tree text-purple-400 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-purple-100 drop-shadow-lg text-center">Тёмный Лес</h3>
                            <p id="forest-desc" class="text-[9px] text-purple-300/60 text-center mt-0.5">Опасность и травы</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-purple-500/40 to-transparent"></div>
                    </button>

                </div>

                <div class="flex items-center gap-2 text-[11px] text-[#c8aa6e] uppercase tracking-[0.3em] pt-2">
                    <i class="fas fa-tower-observation"></i>
                    Цитадель
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <!-- Training Camp (moved here) -->
                    <button id="btn-loc-camp" onclick="router.navigate('training-camp')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-red-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/C1D36CNf/IMG-4570.jpg"
                          alt="Учебный лагерь"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(220,38,38,0.15),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-red-700/20 flex items-center justify-center">
                            <i id="camp-lock-icon" class="fas fa-chevron-right text-red-600/60 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-red-800/60 to-red-950 flex items-center justify-center border-2 border-red-600/60 shadow-[0_0_20px_rgba(220,38,38,0.3)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-shield-halved text-red-500 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-red-100 drop-shadow-lg text-center">Учебный Лагерь</h3>
                            <p id="camp-desc" class="text-[9px] text-red-300/60 text-center mt-0.5">Путь воина</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-red-600/40 to-transparent"></div>
                    </button>

                    <!-- Military Fortress -->
                    <button id="btn-loc-fortress" onclick="router.navigate('military-fortress')" class="panel p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative aspect-square bg-gradient-to-br from-slate-950/80 via-[#1a1a1d] to-[#0f0f10]">
                        <img 
                          src="https://i.postimg.cc/Ss0582pT/IMG-4571.jpg"
                          alt="Военная Крепость"
                          class="absolute inset-0 w-full h-full object-cover opacity-35 witcher-img"
                          onerror="this.onerror=null; this.style.display='none';"
                        />
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-black/70"></div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(148,163,184,0.12),transparent_60%)]"></div>
                        <div class="absolute top-2 right-2 w-6 h-6 rounded-full bg-slate-600/20 flex items-center justify-center">
                            <i id="fortress-lock-icon" class="fas fa-lock text-slate-500/70 text-[10px]"></i>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3">
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-slate-800/60 to-slate-950 flex items-center justify-center border-2 border-slate-500/60 shadow-[0_0_20px_rgba(148,163,184,0.25)] mb-2 group-hover:scale-110 transition-transform">
                                <i class="fas fa-tower-observation text-slate-300 text-xl drop-shadow-lg"></i>
                            </div>
                            <h3 class="medieval-font text-sm text-slate-100 drop-shadow-lg text-center">Военная Крепость</h3>
                            <p id="fortress-desc" class="text-[9px] text-slate-300/60 text-center mt-0.5">Только для обученных</p>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-slate-500/40 to-transparent"></div>
                    </button>

                    <!-- Online Mode (Soon) -->
                    <button onclick="ui.showFloatText(this, 'Скоро', '#777')" class="panel col-span-2 p-0 rounded-lg overflow-hidden group hover:border-[#c8aa6e] transition-all relative h-20 bg-gradient-to-br from-[#1a1a1d] via-[#121214] to-[#0f0f10]">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(200,170,110,0.12),transparent_60%)]"></div>
                        <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/30 to-black/60"></div>
                        <div class="absolute inset-0 flex items-center justify-between px-5">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-[#111] border border-[#c8aa6e]/40 flex items-center justify-center shadow-[0_0_18px_rgba(200,170,110,0.18)]">
                                    <i class="fas fa-globe text-[#c8aa6e] text-lg"></i>
                                </div>
                                <div class="text-left">
                                    <div class="medieval-font text-sm text-[#e0e0e0]">Онлайн режим</div>
                                    <div class="text-[10px] text-[#777]">Скоро</div>
                                </div>
                            </div>
                            <div class="text-[10px] px-2 py-1 rounded border border-[#333] bg-black/30 text-[#777] uppercase tracking-widest">
                                Скоро
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#c8aa6e]/30 to-transparent"></div>
                    </button>
                </div>
            </div>
        </section>

        <!-- SUB-VIEW: JOBS -->
        <section id="view-jobs" class="hidden space-y-4">
            <!-- Header with Gradient -->
            <div class="loc-hero h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-[#0b2a55]/80 via-[#1a1a1d] to-[#0f0f10]" data-loc="jobs" style="--hero-img: none;">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(30,144,255,0.25),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#1E90FF]/60 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-[#1E90FF]/40 bg-black/30 flex items-center justify-center text-[#7fb7ff] hover:bg-[#1E90FF]/20 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#0e3a6b]/70 to-[#0b2a55] flex items-center justify-center border-2 border-[#1E90FF]/60 shadow-[0_0_15px_rgba(30,144,255,0.35)]">
                        <i class="fas fa-hammer text-[#1E90FF] text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-[#dbeafe] drop-shadow-md">Работы</h2>
                </div>
            </div>

            <!-- The Port -->
            <div id="job-port" class="panel rounded-lg p-0 relative overflow-hidden h-40 group">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1549140600-78c9b8275ee3?q=80&w=2070')] bg-cover bg-center opacity-30 group-hover:opacity-40 transition-opacity"></div>
                <div class="absolute inset-0 p-4 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="medieval-font text-lg text-white drop-shadow-md">Порт</h3>
                            <p class="text-xs text-gray-300 drop-shadow-md">Ловля рыбы для рынка.</p>
                            <p class="text-xs text-[#c8aa6e] mt-1 drop-shadow-md" id="job-info-port">Требуется: Удочка</p>
                        </div>
                        <span class="text-xs bg-green-900/80 text-green-200 px-2 py-0.5 rounded border border-green-800 backdrop-blur-sm">Ур 1</span>
                    </div>
                    <div>
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-sm text-[#e0e0e0] flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-fish"></i> <span id="reward-port" class="font-bold">1-2 Рыбы</span>
                            </div>
                            <div class="text-sm text-blue-400 flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-star"></i> +1 XP
                            </div>
                        </div>
                        <button id="btn-work-port" onclick="game.work('port', event)" class="btn-medieval w-full py-2 rounded font-bold shadow-lg">
                            <i class="fas fa-fish mr-2"></i> Рыбачить
                        </button>
                    </div>
                </div>
            </div>

            <!-- The Loader (Unlocked by Alex) -->
            <div id="job-loader" class="panel rounded-lg p-0 relative overflow-hidden h-40 group hidden">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1578575437130-527eed3abbec?q=80&w=2070')] bg-cover bg-center opacity-30 group-hover:opacity-40 transition-opacity"></div>
                <div class="absolute inset-0 p-4 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="medieval-font text-lg text-white drop-shadow-md">Грузчик в порту</h3>
                            <p class="text-xs text-gray-300 drop-shadow-md">Разгрузка мешков с зерном.</p>
                            <p class="text-xs text-[#c8aa6e] mt-1 drop-shadow-md" id="job-info-loader"><span class="text-green-500"><i class="fas fa-check"></i> Работа от Алекса</span></p>
                        </div>
                        <span class="text-xs bg-blue-900/80 text-blue-200 px-2 py-0.5 rounded border border-blue-800 backdrop-blur-sm">Ур 3</span>
                    </div>
                    <div>
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-sm text-[#e0e0e0] flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-coins"></i> <span id="reward-loader" class="font-bold">6 Золота</span>
                            </div>
                            <div class="text-sm text-blue-400 flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-star"></i> +2 XP
                            </div>
                            <div class="text-sm text-green-400 flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-shield-alt"></i> 1% травма
                            </div>
                        </div>
                        <button id="btn-work-loader" onclick="game.work('loader', event)" class="btn-medieval w-full py-2 rounded font-bold shadow-lg">
                            <i class="fas fa-box mr-2"></i> Разгружать
                        </button>
                    </div>
                </div>
            </div>

            <!-- The Field -->
            <div id="job-field" class="panel rounded-lg p-0 relative overflow-hidden h-40 opacity-50 group">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=2070')] bg-cover bg-center opacity-30 group-hover:opacity-40 transition-opacity"></div>
                 <div class="absolute inset-0 p-4 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="medieval-font text-lg text-white drop-shadow-md">Пшеничное поле</h3>
                            <p class="text-xs text-gray-300 drop-shadow-md">Сбор урожая под солнцем.</p>
                            <p class="text-xs text-[#c8aa6e] mt-1 drop-shadow-md" id="job-info-field">Требуется: Серп</p>
                        </div>
                        <span class="text-xs bg-gray-800/80 text-gray-400 px-2 py-0.5 rounded border border-gray-700 backdrop-blur-sm">Ур 5</span>
                    </div>
                    
                    <div>
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-sm text-[#e0e0e0] flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-wheat-awn"></i> <span id="reward-field" class="font-bold">1-2 Пшеницы</span>
                            </div>
                            <div class="text-sm text-blue-400 flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-star"></i> +3 XP
                            </div>
                        </div>
                        <button id="btn-work-field" disabled onclick="game.work('field', event)" class="btn-medieval w-full py-2 rounded font-bold flex items-center justify-center gap-2 shadow-lg">
                            <i class="fas fa-lock text-xs"></i> Закрыто
                        </button>
                    </div>
                </div>
            </div>

            <!-- The Mine -->
            <div id="job-mine" class="panel rounded-lg p-0 relative overflow-hidden h-40 opacity-50 group">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1516937963518-0096035d50ac?q=80&w=2070')] bg-cover bg-center opacity-30 group-hover:opacity-40 transition-opacity"></div>
                 <div class="absolute inset-0 p-4 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="medieval-font text-lg text-white drop-shadow-md">Железный рудник</h3>
                            <p class="text-xs text-gray-300 drop-shadow-md">Опасная работа в темноте.</p>
                            <p class="text-xs text-[#c8aa6e] mt-1 drop-shadow-md" id="job-info-mine">Требуется: Кирка</p>
                        </div>
                        <span class="text-xs bg-gray-800/80 text-gray-400 px-2 py-0.5 rounded border border-gray-700 backdrop-blur-sm">Ур 15</span>
                    </div>
                    
                    <div>
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-sm text-[#e0e0e0] flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-cube"></i> <span id="reward-mine" class="font-bold">1-2 Руды</span>
                            </div>
                            <div class="text-sm text-blue-400 flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-star"></i> +8 XP
                            </div>
                            <div class="text-[11px] text-emerald-400 flex items-center gap-1 drop-shadow-md">
                                <i class="far fa-gem"></i> Шанс найти изумруды
                            </div>
                        </div>
                        <button id="btn-work-mine" disabled onclick="game.work('mine', event)" class="btn-medieval w-full py-2 rounded font-bold flex items-center justify-center gap-2 shadow-lg">
                            <i class="fas fa-lock text-xs"></i> Закрыто
                        </button>
                    </div>
                </div>
            </div>

            <!-- The Hunter -->
            <div id="job-hunter" class="panel rounded-lg p-0 relative overflow-hidden h-40 opacity-50 group">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1599409385627-c37025816b3f?q=80&w=2070')] bg-cover bg-center opacity-40 group-hover:opacity-50 transition-opacity"></div>
                 <div class="absolute inset-0 p-4 flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="medieval-font text-lg text-white drop-shadow-md">Охота</h3>
                            <p class="text-xs text-gray-300 drop-shadow-md">Добыча шкур в лесу.</p>
                            <p class="text-xs text-[#c8aa6e] mt-1 drop-shadow-md" id="job-info-hunter">Требуется: Арбалет</p>
                        </div>
                        <span class="text-xs bg-red-900/80 text-red-200 px-2 py-0.5 rounded border border-red-800 backdrop-blur-sm">Ур 30</span>
                    </div>
                    
                    <div>
                        <div class="flex items-center gap-4 mb-3">
                            <div class="text-sm text-[#e0e0e0] flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-scroll"></i> <span id="reward-hunter" class="font-bold">1 Кожа</span>
                            </div>
                            <div class="text-sm text-blue-400 flex items-center gap-1 drop-shadow-md">
                                <i class="fas fa-star"></i> +15 XP
                            </div>
                        </div>
                        <button id="btn-work-hunter" disabled onclick="game.work('hunter', event)" class="btn-medieval w-full py-2 rounded font-bold flex items-center justify-center gap-2 shadow-lg">
                            <i class="fas fa-lock text-xs"></i> Закрыто
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: DARK FOREST -->
        <section id="view-dark-forest" class="hidden space-y-4">
            <div class="loc-hero h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-purple-950/80 via-[#1a1a1d] to-[#0f0f10]" data-loc="dark-forest" style="--hero-img: none;">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(168,85,247,0.2),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-purple-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-purple-900/50 bg-black/30 flex items-center justify-center text-purple-400 hover:bg-purple-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-900/60 to-purple-950 flex items-center justify-center border-2 border-purple-500/60 shadow-[0_0_15px_rgba(168,85,247,0.4)]">
                        <i class="fas fa-tree text-purple-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-purple-300 drop-shadow-md">Тёмный Лес</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4 bg-gradient-to-b from-[#1a1a1d] to-[#100b14] border-purple-900/30">
                <div class="text-center">
                    <p class="text-sm text-[#e0e0e0]">Мрачные деревья скрывают опасности...</p>
                    <p class="text-xs text-purple-400">И редкие ингредиенты.</p>
                </div>

                <!-- Forest NPC -->
                <div class="panel p-3 rounded flex items-center justify-between border-purple-900/30 bg-purple-900/10">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full border border-purple-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-hood-cloak text-purple-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Элара</div>
                            <div class="text-[10px] text-[#a0a0a0]">Следопыт</div>
                        </div>
                    </div>
                    <button onclick="dialogue.start('elara')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>

                <!-- Gather Resources -->
                <div class="p-3 border border-[#333] rounded bg-black/20 flex flex-col gap-2">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded bg-[#222] flex items-center justify-center text-emerald-500">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-gray-200">Собирательство</h4>
                                <p class="text-[10px] text-gray-500">Палки, камни, травы и грибы.</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="locations.forestGather(event)" class="btn-medieval w-full py-2 rounded text-xs border-emerald-900 text-emerald-500 hover:bg-emerald-900/20">
                        Искать (-5 HP)
                    </button>
                    <div class="flex justify-between text-[10px] text-gray-500 px-1">
                        <span>Награда: Ресурсы</span>
                        <span>+3 XP</span>
                    </div>
                </div>

                <!-- Hunt Monsters -->
                <div class="p-3 border border-purple-900/50 rounded bg-purple-900/10 flex flex-col gap-2 relative overflow-hidden">
                    <div class="absolute -right-2 -top-2 text-6xl text-purple-900 opacity-20 pointer-events-none">
                        <i class="fas fa-dragon"></i>
                    </div>
                    <div class="flex justify-between items-center z-10">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded bg-[#222] flex items-center justify-center text-red-500 border border-purple-900">
                                <i class="fas fa-skull"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-gray-200">Охота на чудовищ</h4>
                                <p class="text-[10px] text-gray-500">Углубиться в чащу леса.</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="locations.forestHunt(event)" class="btn-medieval w-full py-2 rounded text-xs border-red-900 text-red-500 hover:bg-red-900/20 z-10">
                        Сразиться (-20 HP)
                    </button>
                    <div class="flex justify-between text-[10px] text-gray-500 px-1 z-10">
                        <span>Награда: Золото/Предметы</span>
                        <span>+20 XP</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: TOWN SQUARE -->
        <section id="view-town-square" class="hidden space-y-4">
            <div class="loc-hero h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-[#3b1f0b]/85 via-[#1a1a1d] to-[#0f0f10]" data-loc="town-square" style="--hero-img: none;">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(139,69,19,0.25),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#8B4513]/60 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-[#8B4513]/40 bg-black/30 flex items-center justify-center text-[#d2a679] hover:bg-[#8B4513]/20 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#5a2d0f]/70 to-[#3b1f0b] flex items-center justify-center border-2 border-[#8B4513]/60 shadow-[0_0_15px_rgba(139,69,19,0.35)]">
                        <i class="fas fa-landmark text-[#c47a2c] text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-[#f5e1c9] drop-shadow-md">Городская площадь</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-6 text-center space-y-4">
                <i class="fas fa-hands text-4xl text-gray-500"></i>
                <div>
                    <p class="text-sm text-[#e0e0e0]">Вы стоите посреди людной площади.</p>
                    <p class="text-xs text-[#a0a0a0]">Иногда прохожие кидают монеты бродягам.</p>
                </div>
                <button onclick="locations.beg(event)" class="btn-medieval w-full py-3 rounded font-bold">
                    <i class="fas fa-hand-holding-medical mr-2"></i> Попрошайничать
                </button>
                <p class="text-[10px] text-gray-600 mb-4">+2 Золота за клик</p>

                <div class="grid grid-cols-2 gap-3 border-t border-[#333] pt-4 mt-2">
                    <div class="flex flex-col items-center">
                        <div class="w-10 h-10 rounded-full border border-[#c8aa6e] bg-[#222] flex items-center justify-center mb-1">
                            <i class="fas fa-user-tie text-[#c8aa6e]"></i>
                        </div>
                        <p class="text-xs text-[#e0e0e0] mb-1">Артур</p>
                        <button onclick="dialogue.start('arthur')" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                            Говорить
                        </button>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="w-10 h-10 rounded-full border border-amber-500 bg-[#222] flex items-center justify-center mb-1">
                            <i class="fas fa-clipboard-list text-amber-400"></i>
                        </div>
                        <p class="text-xs text-[#e0e0e0] mb-1">Доска</p>
                        <button onclick="router.navigate('bulletin')" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                            Смотреть
                        </button>
                    </div>
                </div>
                
                <!-- Book House Button -->
                <div class="mt-4">
                     <button onclick="router.navigate('bookhouse')" class="panel w-full p-3 rounded flex items-center justify-between group hover:border-blue-500 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-[#111] border border-blue-500 flex items-center justify-center">
                                <i class="fas fa-book text-blue-400"></i>
                            </div>
                            <div class="text-left">
                                <div class="text-sm font-bold text-[#e0e0e0]">Книжный Дом</div>
                                <div class="text-[10px] text-[#777]">Рецепты и знания</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500 group-hover:text-blue-500"></i>
                    </button>
                </div>

                <!-- Tailor Button -->
                <div class="mt-3">
                    <button onclick="router.navigate('tailor')" class="panel w-full p-3 rounded flex items-center justify-between group hover:border-pink-500 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-[#111] border border-pink-500 flex items-center justify-center">
                                <i class="fas fa-shirt text-pink-400"></i>
                            </div>
                            <div class="text-left">
                                <div class="text-sm font-bold text-[#e0e0e0]">Мастерская Портного</div>
                                <div class="text-[10px] text-[#777]">Одежда на заказ</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500 group-hover:text-pink-500"></i>
                    </button>
                </div>

                <!-- Shoemaker Button -->
                <div class="mt-3">
                    <button onclick="router.navigate('shoemaker')" class="panel w-full p-3 rounded flex items-center justify-between group hover:border-amber-500 transition-colors">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-[#111] border border-amber-500 flex items-center justify-center">
                                <i class="fas fa-shoe-prints text-amber-400"></i>
                            </div>
                            <div class="text-left">
                                <div class="text-sm font-bold text-[#e0e0e0]">Мастерская Сапожника</div>
                                <div class="text-[10px] text-[#777]">Обувь и ремонт</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500 group-hover:text-amber-500"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- VIEW: BULLETIN BOARD -->
        <section id="view-bulletin" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-amber-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(217,119,6,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('town-square')" class="w-8 h-8 rounded border border-amber-900/50 bg-black/30 flex items-center justify-center text-amber-400 hover:bg-amber-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-900/60 to-amber-950 flex items-center justify-center border-2 border-amber-500/60 shadow-[0_0_15px_rgba(217,119,6,0.3)]">
                        <i class="fas fa-clipboard-list text-amber-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-amber-300 drop-shadow-md">Доска Объявлений</h2>
                </div>
            </div>

            <div class="panel rounded p-4 space-y-4">
                <div class="text-center mb-4">
                    <i class="fas fa-scroll text-3xl text-amber-500 mb-2"></i>
                    <p class="text-sm text-[#a0a0a0]">Здесь вывешивают объявления о работе и просьбы о помощи.</p>
                </div>

                <!-- Active Bounties/Jobs -->
                <div class="space-y-3">
                    <h3 class="text-xs text-[#777] uppercase border-b border-[#333] pb-1">Срочные заказы</h3>
                    
                    <!-- Bounty 1: Fish -->
                    <div class="border border-[#333] rounded p-3 bg-black/20">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-3">
                                <i class="fas fa-fish text-blue-400 text-lg mt-1"></i>
                                <div>
                                    <div class="text-sm font-bold text-[#e0e0e0]">Рыба для таверны</div>
                                    <div class="text-[10px] text-[#777]">Старый Бен ищет свежую рыбу.</div>
                                    <div class="text-[10px] text-gray-500 mt-1">Нужно: 10 Рыб</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-yellow-500 font-bold">100 <i class="fas fa-coins"></i></div>
                                <div class="text-[10px] text-blue-400">+15 XP</div>
                            </div>
                        </div>
                        <button onclick="bulletin.acceptQuest('fish_delivery')" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                            Взять заказ
                        </button>
                    </div>

                    <!-- Bounty 2: Herbs -->
                    <div class="border border-[#333] rounded p-3 bg-black/20">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-3">
                                <i class="fas fa-leaf text-green-400 text-lg mt-1"></i>
                                <div>
                                    <div class="text-sm font-bold text-[#e0e0e0]">Травы для лекаря</div>
                                    <div class="text-[10px] text-[#777]">Мариусу нужны свежие травы.</div>
                                    <div class="text-[10px] text-gray-500 mt-1">Нужно: 8 Трав</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-yellow-500 font-bold">80 <i class="fas fa-coins"></i></div>
                                <div class="text-[10px] text-blue-400">+10 XP</div>
                            </div>
                        </div>
                        <button onclick="bulletin.acceptQuest('herbs_delivery')" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                            Взять заказ
                        </button>
                    </div>

                    <!-- Bounty 3: Ore -->
                    <div class="border border-[#333] rounded p-3 bg-black/20">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-3">
                                <i class="fas fa-cube text-gray-400 text-lg mt-1"></i>
                                <div>
                                    <div class="text-sm font-bold text-[#e0e0e0]">Руда для кузнеца</div>
                                    <div class="text-[10px] text-[#777]">Горну нужна железная руда.</div>
                                    <div class="text-[10px] text-gray-500 mt-1">Нужно: 5 Руды</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-yellow-500 font-bold">200 <i class="fas fa-coins"></i></div>
                                <div class="text-[10px] text-blue-400">+25 XP</div>
                            </div>
                        </div>
                        <button onclick="bulletin.acceptQuest('ore_delivery')" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                            Взять заказ
                        </button>
                    </div>
                </div>

                <!-- Community Notices -->
                <div class="space-y-2 mt-4">
                    <h3 class="text-xs text-[#777] uppercase border-b border-[#333] pb-1">Объявления</h3>
                    
                    <div class="border border-[#333] rounded p-2 bg-black/10 text-[10px] text-gray-400">
                        <i class="fas fa-thumbtack text-red-400 mr-1"></i> "Осторожно! В лесу видели волков." — Стража
                    </div>
                    <div class="border border-[#333] rounded p-2 bg-black/10 text-[10px] text-gray-400">
                        <i class="fas fa-thumbtack text-yellow-400 mr-1"></i> "Куплю кожу. Хорошо плачу." — Бронник
                    </div>
                    <div class="border border-[#333] rounded p-2 bg-black/10 text-[10px] text-gray-400">
                        <i class="fas fa-thumbtack text-blue-400 mr-1"></i> "Ищу помощника на ферму. Обращаться в деревню." — Фермер
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: TAILOR -->
        <section id="view-tailor" class="hidden space-y-4">
            <div class="h-16 w-full relative rounded-lg mb-4 overflow-hidden bg-[#1a1a1d]">
                <div class="absolute inset-0 bg-gradient-to-r from-pink-900/20 to-transparent"></div>
                <div class="absolute top-4 left-4 flex items-center gap-3">
                    <button onclick="router.navigate('town-square')" class="w-8 h-8 rounded border border-[#333] bg-black/50 flex items-center justify-center text-[#a0a0a0] backdrop-blur-sm">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 class="medieval-font text-xl text-pink-400 drop-shadow-lg">Мастерская Портного</h2>
                </div>
            </div>

            <!-- Tailor NPC -->
            <div class="panel p-3 mb-4 rounded flex items-center justify-between border-pink-900/30 bg-pink-900/10">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full border border-pink-500 bg-[#222] flex items-center justify-center">
                        <i class="fas fa-scissors text-pink-400"></i>
                    </div>
                    <div>
                        <div class="text-sm text-[#e0e0e0] font-bold">Портной Питер</div>
                        <div class="text-[10px] text-[#a0a0a0]">Портной</div>
                    </div>
                </div>
                <button onclick="dialogue.start('peter')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                    Говорить
                </button>
            </div>

            <div class="panel rounded p-4 space-y-3">
                <h3 class="medieval-font text-sm text-[#c8aa6e]">Одежда на заказ</h3>
                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-shirt text-[#c8aa6e] text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Одежда крестьянина</div>
                                <div class="text-[10px] text-[#777]">Набор простой чистой одежды.</div>
                            </div>
                        </div>
                        <div class="text-sm text-yellow-400 font-bold">5,000 <i class="fas fa-coins"></i></div>
                    </div>
                    <button onclick="game.buyClothes('peasant', 5000)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить
                    </button>
                </div>

                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-shirt text-[#c8aa6e] text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Одежда состоятельного</div>
                                <div class="text-[10px] text-[#777]">Для тех, кто любит выглядеть солидно.</div>
                            </div>
                        </div>
                        <div class="text-sm text-yellow-400 font-bold">50,000 <i class="fas fa-coins"></i></div>
                    </div>
                    <button onclick="game.buyClothes('rich', 50000)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить
                    </button>
                </div>

                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-crown text-[#c8aa6e] text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Одежда знати</div>
                                <div class="text-[10px] text-[#777]">Высшее качество для истинной элиты.</div>
                            </div>
                        </div>
                        <div class="text-sm text-emerald-400 font-bold">500 <i class="far fa-gem"></i></div>
                    </div>
                    <button onclick="game.buyClothes('noble', 500)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить
                    </button>
                </div>
            </div>
        </section>

        <!-- VIEW: SHOEMAKER -->
        <section id="view-shoemaker" class="hidden space-y-4">
            <div class="h-16 w-full relative rounded-lg mb-4 overflow-hidden bg-[#1a1a1d]">
                <div class="absolute inset-0 bg-gradient-to-r from-amber-900/20 to-transparent"></div>
                <div class="absolute top-4 left-4 flex items-center gap-3">
                    <button onclick="router.navigate('town-square')" class="w-8 h-8 rounded border border-[#333] bg-black/50 flex items-center justify-center text-[#a0a0a0] backdrop-blur-sm">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 class="medieval-font text-xl text-amber-400 drop-shadow-lg">Мастерская Сапожника</h2>
                </div>
            </div>

            <!-- Shoemaker NPC -->
            <div class="panel p-3 mb-4 rounded flex items-center justify-between border-amber-900/30 bg-amber-900/10">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full border border-amber-500 bg-[#222] flex items-center justify-center">
                        <i class="fas fa-shoe-prints text-amber-400"></i>
                    </div>
                    <div>
                        <div class="text-sm text-[#e0e0e0] font-bold">Сапожник Лорен</div>
                        <div class="text-[10px] text-[#a0a0a0]">Мастер обуви</div>
                    </div>
                </div>
                <button onclick="dialogue.start('shoemaker')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                    Говорить
                </button>
            </div>

            <div class="panel rounded p-4 space-y-3">
                <h3 class="medieval-font text-sm text-[#c8aa6e]">Обувь на заказ</h3>

                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-shoe-prints text-amber-400 text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Ботинки крестьянина</div>
                                <div class="text-[10px] text-[#777]">Простая крепкая обувь для дороги.</div>
                            </div>
                        </div>
                        <div class="text-sm text-yellow-400 font-bold">4,000 <i class="fas fa-coins"></i></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="shoemaker.buyShoes('peasant')" class="btn-medieval w-full py-1.5 rounded text-[10px]">Купить</button>
                        <button onclick="shoemaker.sellShoes('peasant')" class="btn-medieval w-full py-1.5 rounded text-[10px] border-amber-700 text-amber-300">Продать</button>
                    </div>
                </div>

                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-shoe-prints text-emerald-400 text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Качественные ботинки</div>
                                <div class="text-[10px] text-[#777]">Удобные, мягкие и прочные.</div>
                            </div>
                        </div>
                        <div class="text-sm text-emerald-400 font-bold">100 <i class="far fa-gem"></i></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="shoemaker.buyShoes('quality')" class="btn-medieval w-full py-1.5 rounded text-[10px]">Купить</button>
                        <button onclick="shoemaker.sellShoes('quality')" class="btn-medieval w-full py-1.5 rounded text-[10px] border-emerald-700 text-emerald-300">Продать</button>
                    </div>
                </div>

                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-crown text-yellow-400 text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Элитные ботинки</div>
                                <div class="text-[10px] text-[#777]">Для тех, кто ценит роскошь.</div>
                            </div>
                        </div>
                        <div class="text-sm text-emerald-400 font-bold">300 <i class="far fa-gem"></i></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="shoemaker.buyShoes('elite')" class="btn-medieval w-full py-1.5 rounded text-[10px]">Купить</button>
                        <button onclick="shoemaker.sellShoes('elite')" class="btn-medieval w-full py-1.5 rounded text-[10px] border-yellow-700 text-yellow-300">Продать</button>
                    </div>
                </div>

                <div class="panel p-3 rounded bg-black/20 border border-[#333] text-[10px] text-[#a0a0a0]">
                    <i class="fas fa-info-circle text-amber-400 mr-1"></i> Старую обувь можно сдать за половину стоимости.
                </div>
            </div>
        </section>

        <!-- VIEW: BOOK HOUSE -->
        <section id="view-bookhouse" class="hidden space-y-4">
            <div class="h-16 w-full relative rounded-lg mb-4 overflow-hidden bg-[#1a1a1d]">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-900/20 to-transparent"></div>
                <div class="absolute top-4 left-4 flex items-center gap-3">
                    <button onclick="router.navigate('town-square')" class="w-8 h-8 rounded border border-[#333] bg-black/50 flex items-center justify-center text-[#a0a0a0] backdrop-blur-sm">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 class="medieval-font text-xl text-blue-400 drop-shadow-lg">Книжный Дом</h2>
                </div>
            </div>

            <!-- Book House NPC -->
            <div class="panel p-3 mb-4 rounded flex items-center justify-between border-blue-900/30 bg-blue-900/10">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full border border-pink-500 bg-[#222] flex items-center justify-center">
                        <i class="fas fa-feather text-pink-400"></i>
                    </div>
                    <div>
                        <div class="text-sm text-[#e0e0e0] font-bold">Лили</div>
                        <div class="text-[10px] text-[#a0a0a0]">Хранительница знаний</div>
                    </div>
                </div>
                <button onclick="dialogue.start('lili')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                    Говорить
                </button>
            </div>

            <div class="panel rounded p-4 space-y-4">
                <h3 class="medieval-font text-sm text-[#c8aa6e] border-b border-[#333] pb-2">Рецепты в продаже</h3>
                
                <!-- Food Recipe -->
                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-drumstick-bite text-amber-400 text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Рецепт: Жаркое</div>
                                <div class="text-[10px] text-[#777]">Готовьте еду из мяса. +30 HP</div>
                                <div class="text-[10px] text-gray-500 mt-1">Требуется: 2 Мяса</div>
                            </div>
                        </div>
                        <div class="text-sm text-emerald-400 font-bold">50 <i class="far fa-gem"></i></div>
                    </div>
                    <button id="btn-buy-recipe-food" onclick="game.buyRecipe('food', 50)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить Рецепт
                    </button>
                </div>

                <!-- Sword Recipe -->
                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-gavel text-gray-400 text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Рецепт: Самодельный Меч</div>
                                <div class="text-[10px] text-[#777]">Создайте простое оружие. +5 Урона</div>
                                <div class="text-[10px] text-gray-500 mt-1">Требуется: 3 Руды, 2 Палки</div>
                            </div>
                        </div>
                        <div class="text-sm text-emerald-400 font-bold">100 <i class="far fa-gem"></i></div>
                    </div>
                    <button id="btn-buy-recipe-sword" onclick="game.buyRecipe('sword', 100)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить Рецепт
                    </button>
                </div>

                <!-- Leather Armor Recipe -->
                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-vest text-amber-600 text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Рецепт: Кожаная Броня</div>
                                <div class="text-[10px] text-[#777]">Защитная броня из кожи. +10 Защиты</div>
                                <div class="text-[10px] text-gray-500 mt-1">Требуется: 5 Кожи</div>
                            </div>
                        </div>
                        <div class="text-sm text-emerald-400 font-bold">150 <i class="far fa-gem"></i></div>
                    </div>
                    <button id="btn-buy-recipe-armor" onclick="game.buyRecipe('armor', 150)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить Рецепт
                    </button>
                </div>

                <!-- Upgraded Bag Recipe -->
                <div class="border border-[#333] rounded p-3 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-3">
                            <i class="fas fa-suitcase text-yellow-500 text-xl mt-1"></i>
                            <div>
                                <div class="text-sm font-bold text-[#e0e0e0]">Рецепт: Улучшенная Сумка</div>
                                <div class="text-[10px] text-[#777]">Больше места в инвентаре. +8 слотов</div>
                                <div class="text-[10px] text-gray-500 mt-1">Требуется: 3 Кожи, 2 Палки</div>
                            </div>
                        </div>
                        <div class="text-sm text-emerald-400 font-bold">200 <i class="far fa-gem"></i></div>
                    </div>
                    <button id="btn-buy-recipe-bag" onclick="game.buyRecipe('bag', 200)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить Рецепт
                    </button>
                </div>
            </div>
        </section>

        <!-- VIEW: HEALER -->
        <section id="view-healer" class="hidden space-y-4">
            <div class="loc-hero h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-red-950/80 via-[#1a1a1d] to-[#0f0f10]" data-loc="healer" style="--hero-img: none;">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(239,68,68,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-red-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-red-900/50 bg-black/30 flex items-center justify-center text-red-400 hover:bg-red-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-red-900/60 to-red-950 flex items-center justify-center border-2 border-red-500/60 shadow-[0_0_15px_rgba(239,68,68,0.3)]">
                        <i class="fas fa-mortar-pestle text-red-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-red-300 drop-shadow-md">Хижина Лекаря</h2>
                </div>
            </div>

            <!-- NPC Marius -->
            <div class="panel p-3 mb-4 rounded flex items-center justify-between border-red-900/30 bg-red-900/10">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full border border-red-500 bg-[#222] overflow-hidden">
                         <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Marius&backgroundColor=1a1a1d&skinColor=ecad80&hair=long02&hairColor=3e3e42" alt="Мариус" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <div class="text-sm text-[#e0e0e0] font-bold">Мариус</div>
                        <div class="text-[10px] text-[#a0a0a0]">Алхимик</div>
                    </div>
                </div>
                <button onclick="dialogue.start('marius')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                    Говорить
                </button>
            </div>

            <!-- Healing Service -->
            <div class="panel rounded p-4 space-y-3">
                <h3 class="medieval-font text-sm text-[#c8aa6e]">Лечение</h3>
                <div class="flex items-center justify-between">
                    <div class="text-xs text-[#a0a0a0]">Восстановить здоровье</div>
                    <div class="text-xs text-yellow-500">50 <i class="fas fa-coins"></i></div>
                </div>
                <button onclick="game.heal(50, 50)" class="btn-medieval w-full py-2 rounded text-xs text-red-400 border-red-900 hover:bg-red-900/20">
                    <i class="fas fa-heart mr-2"></i> +50 HP
                </button>
            </div>

            <!-- Recipes Shop -->
            <div class="panel rounded p-4 space-y-4">
                <h3 class="medieval-font text-sm text-[#c8aa6e]">Тайные Знания (Рецепты)</h3>
                
                <!-- Immortality Recipe -->
                <div class="border border-[#333] rounded p-2 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-2">
                            <i class="fas fa-scroll text-purple-400 mt-1"></i>
                            <div>
                                <div class="text-xs font-bold text-[#e0e0e0]">Зелье Бессмертия</div>
                                <div class="text-[10px] text-[#777]">Неуязвимость на 2 минуты.</div>
                            </div>
                        </div>
                        <div class="text-xs text-emerald-400 font-bold">100 <i class="far fa-gem"></i></div>
                    </div>
                    <button id="btn-buy-recipe-immortality" onclick="game.buyRecipe('immortality', 100)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить Рецепт
                    </button>
                </div>

                <!-- Luck Recipe -->
                <div class="border border-[#333] rounded p-2 bg-black/20">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex gap-2">
                            <i class="fas fa-scroll text-green-400 mt-1"></i>
                            <div>
                                <div class="text-xs font-bold text-[#e0e0e0]">Зелье Удачи</div>
                                <div class="text-[10px] text-[#777]">x2 Добыча на 2 минуты.</div>
                            </div>
                        </div>
                        <div class="text-xs text-emerald-400 font-bold">50 <i class="far fa-gem"></i></div>
                    </div>
                    <button id="btn-buy-recipe-luck" onclick="game.buyRecipe('luck', 50)" class="btn-medieval w-full py-1.5 rounded text-[10px]">
                        Купить Рецепт
                    </button>
                </div>
            </div>

            <!-- Crafting Station (Visible if recipes unlocked) -->
            <div id="healer-crafting-station" class="hidden panel rounded p-4 space-y-3 border-t-2 border-[#c8aa6e]">
                <h3 class="medieval-font text-sm text-[#c8aa6e]">Алхимический Стол</h3>
                
                <div id="craft-action-immortality" class="hidden flex justify-between items-center bg-[#111] p-2 rounded">
                    <div class="text-xs text-purple-400">Зелье Бессмертия</div>
                    <button onclick="game.activateEffect('immortality')" class="bg-[#222] border border-purple-500 text-purple-500 px-3 py-1 rounded text-[10px] hover:bg-purple-900/30">
                        Использовать (10 трав)
                    </button>
                </div>

                <div id="craft-action-luck" class="hidden flex justify-between items-center bg-[#111] p-2 rounded">
                    <div class="text-xs text-green-400">Зелье Удачи</div>
                    <button onclick="game.activateEffect('luck')" class="bg-[#222] border border-green-500 text-green-500 px-3 py-1 rounded text-[10px] hover:bg-green-900/30">
                        Использовать (5 грибов)
                    </button>
                </div>
            </div>
        </section>

        <!-- VIEW: TREASURY -->
        <section id="view-treasury" class="hidden space-y-4">
            <div class="loc-hero h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-yellow-950/80 via-[#1a1a1d] to-[#0f0f10]" data-loc="treasury" style="--hero-img: none;">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(234,179,8,0.2),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-yellow-900/50 bg-black/30 flex items-center justify-center text-yellow-400 hover:bg-yellow-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-yellow-900/60 to-yellow-950 flex items-center justify-center border-2 border-yellow-500/60 shadow-[0_0_15px_rgba(234,179,8,0.3)]">
                        <i class="fas fa-coins text-yellow-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-yellow-300 drop-shadow-md">Казна</h2>
                </div>
            </div>

            <!-- Bank Info -->
            <div class="panel rounded-lg p-4 flex items-center justify-between bg-[#101012]">
                <div>
                    <div class="text-xs text-[#a0a0a0] uppercase">В сейфе</div>
                    <div class="text-xl font-bold text-[#c8aa6e]">
                        <i class="fas fa-lock text-xs mr-1"></i> <span id="bank-display">0</span>
                    </div>
                </div>
                <i class="fas fa-shield-alt text-2xl text-[#333]"></i>
            </div>

            <!-- Deposit/Withdraw -->
            <div class="panel rounded-lg p-4 space-y-3">
                <h3 class="text-sm font-bold text-[#e0e0e0] border-b border-[#333] pb-2">Хранилище</h3>


                <div class="mt-2 space-y-2">
                    <div class="flex items-center justify-between text-[10px] text-[#777]">
                        <div>На руках: <span id="wallet-display" class="text-[#c8aa6e] font-bold">0</span></div>
                        <div>В сейфе: <span class="text-[#c8aa6e] font-bold" id="bank-display-mini">0</span></div>
                    </div>

                    <div class="flex gap-2">
                        <input id="bank-amount-input" type="number" min="1" step="1" placeholder="Сумма" class="w-full bg-[#111] border border-[#333] text-center text-xs text-white rounded p-2 outline-none focus:border-[#c8aa6e]">
                        <button onclick="locations.treasurySetMax('deposit', event)" class="px-3 bg-[#222] border border-[#444] rounded text-xs text-gray-400 hover:text-white">Max</button>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="locations.treasuryDepositAmount(event)" class="btn-medieval py-2 text-xs rounded">
                            Положить
                        </button>
                        <button onclick="locations.treasuryWithdrawAmount(event)" class="btn-medieval py-2 text-xs rounded">
                            Снять
                        </button>
                    </div>

                    <div class="flex justify-end">
                        <button onclick="locations.treasurySetMax('withdraw', event)" class="text-[10px] text-gray-500 underline underline-offset-2 hover:text-[#c8aa6e]">Max для снятия</button>
                    </div>
                </div>

                <p class="text-[10px] text-center text-[#777]">Деньги в сейфе защищены от краж.</p>
            </div>

            <!-- Exchange -->
            <div class="panel rounded-lg p-4 space-y-3">
                <h3 class="text-sm font-bold text-[#e0e0e0] border-b border-[#333] pb-2">Обмен Валюты</h3>
                <div class="flex justify-between items-center bg-[#000] p-2 rounded border border-[#333]">
                    <div class="flex items-center gap-2">
                        <i class="far fa-gem text-emerald-400"></i>
                        <span class="font-bold">1</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-600"></i>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-coins text-yellow-500"></i>
                        <span class="font-bold">1000</span>
                    </div>
                </div>
                <button onclick="locations.treasuryExchange(event)" class="btn-medieval w-full py-2 rounded text-sm">
                    Обменять
                </button>
            </div>
        </section>

        <!-- VIEW: TAVERN -->
        <section id="view-tavern" class="hidden space-y-4">
            <div class="loc-hero h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-orange-950/80 via-[#1a1a1d] to-[#0f0f10]" data-loc="tavern" style="--hero-img: none;">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(249,115,22,0.2),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-orange-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-orange-900/50 bg-black/30 flex items-center justify-center text-orange-400 hover:bg-orange-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-orange-900/60 to-orange-950 flex items-center justify-center border-2 border-orange-500/60 shadow-[0_0_15px_rgba(249,115,22,0.3)]">
                        <i class="fas fa-beer-mug-empty text-orange-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-orange-300 drop-shadow-md">Таверна</h2>
                </div>
            </div>

            <!-- Tavern NPC -->
            <div class="panel p-3 mb-4 rounded flex items-center justify-between border-orange-900/30 bg-orange-900/10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full border border-orange-500 bg-[#222] flex items-center justify-center">
                        <i class="fas fa-wine-glass text-orange-400"></i>
                    </div>
                    <div>
                        <div class="text-sm text-[#e0e0e0] font-bold">Старый Бен</div>
                        <div class="text-[10px] text-[#a0a0a0]">Трактирщик</div>
                    </div>
                </div>
                <button onclick="dialogue.start('ben')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                    Слухи
                </button>
            </div>

            <!-- Rent Room -->
            <div class="panel rounded-lg p-4 relative overflow-hidden">
                <div class="absolute right-0 top-0 p-4 opacity-20">
                    <i class="fas fa-bed text-6xl"></i>
                </div>
                <h3 class="medieval-font text-lg text-[#e0e0e0]">Ночлег</h3>
                <p class="text-xs text-[#a0a0a0] mb-3 w-3/4">Восстанавливает 100% здоровья.</p>
                <div class="flex items-center gap-2 mb-3 text-sm">
                    <span class="text-[#c8aa6e]">Цена: 20</span> <i class="far fa-gem text-emerald-400"></i> / сутки
                </div>
                <button id="btn-rent-room" onclick="locations.tavernRent()" class="btn-medieval w-full py-2 rounded text-sm">
                    Снять комнату
                </button>
                <p id="rent-status" class="text-xs text-green-500 mt-2 hidden">
                    <i class="fas fa-check-circle"></i> Комната оплачена
                </p>
            </div>

            <!-- Brawl Night -->
            <div class="panel rounded-lg p-4 relative overflow-hidden border-orange-900/40 bg-orange-900/10">
                <div class="absolute -right-6 -top-6 text-7xl text-orange-900/30 pointer-events-none">
                    <i class="fas fa-hand-fist"></i>
                </div>
                <div class="flex items-center justify-between mb-2">
                    <div>
                        <h3 class="medieval-font text-lg text-orange-300">Кулачные бои</h3>
                        <p class="text-[10px] text-[#a0a0a0]">Раз в час. Ставки и слава.</p>
                    </div>
                    <div class="text-[10px] text-[#c8aa6e] uppercase tracking-wider">Арена</div>
                </div>
                <div class="panel p-2 rounded bg-black/40 border border-[#333] text-[10px] text-[#a0a0a0] mb-3">
                    Победа даёт золото и репутацию, поражение — травмы. Требуется 20+ HP.
                </div>
                <div class="flex items-center justify-between text-[10px] text-[#777] mb-3">
                    <span>До следующего боя:</span>
                    <span id="brawl-timer" class="text-[#c8aa6e] font-mono">Доступно</span>
                </div>
                <button id="btn-brawl" onclick="locations.tavernBrawl(event)" class="btn-medieval w-full py-2 rounded font-bold border-orange-500 text-orange-300">
                    Выйти на бой
                </button>
            </div>

            <!-- Food & Thomas Event -->
            <div class="panel rounded-lg p-4 space-y-3">
                <h3 class="medieval-font text-lg text-[#c8aa6e]">Горячая еда</h3>
                <p class="text-xs text-[#a0a0a0]">Восстанавливает 100% здоровья и 100% сытости.</p>
                
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="locations.tavernEat('stew')" class="panel p-2 rounded flex flex-col items-center bg-[#222] border border-[#333] hover:border-[#c8aa6e] transition-colors group">
                        <i class="fas fa-bowl-food text-orange-400 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <span class="text-xs text-[#e0e0e0] font-bold">Мясное рагу</span>
                        <span class="text-[10px] text-yellow-500 mt-1">100 <i class="fas fa-coins"></i></span>
                    </button>
                    <button onclick="locations.tavernEat('soup')" class="panel p-2 rounded flex flex-col items-center bg-[#222] border border-[#333] hover:border-[#c8aa6e] transition-colors group">
                        <i class="fas fa-utensils text-yellow-200 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <span class="text-xs text-[#e0e0e0] font-bold">Куриный суп</span>
                        <span class="text-[10px] text-yellow-500 mt-1">100 <i class="fas fa-coins"></i></span>
                    </button>
                </div>
            </div>

            <!-- Wheel of Fortune -->
            <div class="panel rounded-lg p-4 text-center space-y-4 overflow-hidden relative">
                <h3 class="medieval-font text-lg text-[#c8aa6e]">Колесо Удачи</h3>
                
                <div class="relative w-48 h-48 mx-auto my-4">
                    <div id="wheel" class="w-full h-full rounded-full border-4 border-[#c8aa6e] relative bg-[#222] shadow-[0_0_20px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden wheel-container">
                        <div class="absolute inset-0 opacity-20 bg-[conic-gradient(#444_0deg_36deg,#222_36deg_72deg,#444_72deg_108deg,#222_108deg_144deg,#444_144deg_180deg,#222_180deg_216deg,#444_216deg_252deg,#222_252deg_288deg,#444_288deg_324deg,#222_324deg_360deg)]"></div>
                        <i class="fas fa-dice text-4xl text-[#555]"></i>
                    </div>
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 text-[#c8aa6e] z-10 text-2xl">
                        <i class="fas fa-caret-down"></i>
                    </div>
                </div>

                <div class="text-sm text-[#a0a0a0]">
                    Цена: <span class="text-emerald-400 font-bold">1 <i class="far fa-gem"></i></span>
                </div>

                <div class="grid grid-cols-2 gap-2 text-[10px] text-gray-500 text-left px-2">
                    <div>10 <i class="far fa-gem text-emerald-400"></i> (10%)</div>
                    <div>100 <i class="far fa-gem text-emerald-400"></i> (1%)</div>
                    <div>10к <i class="fas fa-coins text-yellow-500"></i> (15%)</div>
                    <div>5к <i class="fas fa-coins text-yellow-500"></i> (25%)</div>
                    <div class="col-span-2 text-center">1к <i class="fas fa-coins text-yellow-500"></i> (49%)</div>
                </div>

                <button id="btn-spin" onclick="locations.tavernSpin()" class="btn-medieval w-full py-2 rounded font-bold">
                    Крутить!
                </button>
            </div>
        </section>

        <!-- VIEW: MARKET -->
        <section id="view-market" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-amber-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(217,119,6,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
                <div class="absolute top-1/2 left-4 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-900/60 to-amber-950 flex items-center justify-center border-2 border-amber-500/60 shadow-[0_0_15px_rgba(217,119,6,0.3)]">
                        <i class="fas fa-store text-amber-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-amber-300 drop-shadow-md">Торговые ряды</h2>
                </div>
            </div>

            <!-- Market NPC -->
            <div class="panel p-3 mb-4 rounded flex items-center justify-between border-blue-900/30 bg-blue-900/10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full border border-gray-500 bg-[#222] flex items-center justify-center">
                        <i class="fas fa-hammer text-gray-400"></i>
                    </div>
                    <div>
                        <div class="text-sm text-[#e0e0e0] font-bold">Горн</div>
                        <div class="text-[10px] text-[#a0a0a0]">Кузнец</div>
                    </div>
                </div>
                <button onclick="dialogue.start('gorn')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                    Говорить
                </button>
            </div>

            <!-- Market Tabs -->
            <div class="flex items-center gap-2 overflow-x-auto pb-2 mb-2 no-scrollbar">
                <button onclick="market.switchCategory('tools')" id="tab-market-tools" class="sub-tab active">Инструменты</button>
                <button onclick="market.switchCategory('armor')" id="tab-market-armor" class="sub-tab">Бронник</button>
                <button onclick="market.switchCategory('weapons')" id="tab-market-weapons" class="sub-tab">Мечник</button>
                <button onclick="market.switchCategory('horses')" id="tab-market-horses" class="sub-tab">Конюшня</button>
            </div>

            <!-- Content: Tools -->
            <div id="market-tools" class="space-y-3">
                <!-- Rod -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-[#c8aa6e]">
                            <svg class="w-6 h-6 text-[#c8aa6e]" viewBox="0 0 24 24"><use href="#icon-rod"></use></svg>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Удочка</div>
                            <div class="text-xs text-[#a0a0a0]">Позволяет ловить рыбу</div>
                            <div class="text-xs text-blue-400" id="market-lvl-rod">Ур: 0</div>
                        </div>
                    </div>
                    <button id="btn-buy-rod" onclick="market.buyOrUpgradeTool('rod')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        <span id="price-rod">50</span> <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                <!-- Sickle -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-[#c8aa6e]">
                            <svg class="w-6 h-6 text-[#c8aa6e]" viewBox="0 0 24 24"><use href="#icon-sickle"></use></svg>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Серп</div>
                            <div class="text-xs text-[#a0a0a0]">Позволяет собирать пшеницу</div>
                            <div class="text-xs text-blue-400" id="market-lvl-sickle">Ур: 0</div>
                        </div>
                    </div>
                    <button id="btn-buy-sickle" onclick="market.buyOrUpgradeTool('sickle')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        <span id="price-sickle">500</span> <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                <!-- Pickaxe -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-[#c8aa6e]">
                            <i class="fas fa-person-digging"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Кирка</div>
                            <div class="text-xs text-[#a0a0a0]">Позволяет добывать руду</div>
                            <div class="text-xs text-blue-400" id="market-lvl-pickaxe">Ур: 0</div>
                        </div>
                    </div>
                    <button id="btn-buy-pickaxe" onclick="market.buyOrUpgradeTool('pickaxe')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        <span id="price-pickaxe">2000</span> <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                 <!-- Crossbow -->
                 <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-[#c8aa6e]">
                            <svg class="w-6 h-6 text-[#c8aa6e]" viewBox="0 0 24 24"><use href="#icon-crossbow"></use></svg>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Арбалет</div>
                            <div class="text-xs text-[#a0a0a0]">Позволяет добывать шкуры</div>
                            <div class="text-xs text-blue-400" id="market-lvl-crossbow">Ур: 0</div>
                        </div>
                    </div>
                    <button id="btn-buy-crossbow" onclick="market.buyOrUpgradeTool('crossbow')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        <span id="price-crossbow">5000</span> <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                <!-- Sword -->
                 <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-[#c8aa6e]">
                            <i class="fas fa-khanda"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Меч</div>
                            <div class="text-xs text-[#a0a0a0]">Оружие для защиты</div>
                            <div class="text-xs text-blue-400" id="market-lvl-sword">Ур: 0</div>
                        </div>
                    </div>
                    <button id="btn-buy-sword" onclick="market.buyOrUpgradeTool('sword')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        <span id="price-sword">1000</span> <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
            </div>

            <!-- Content: Weapons (Swords) -->
            <div id="market-weapons" class="hidden space-y-3">
                <!-- Wooden Sword -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-amber-700">
                            <i class="fas fa-splotch text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Деревянный меч</div>
                            <div class="text-xs text-[#a0a0a0]">Урон: +5</div>
                        </div>
                    </div>
                    <button onclick="market.buySword('wooden')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        5,000 <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Stone Sword -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-gray-500">
                            <i class="fas fa-monument text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Каменный меч</div>
                            <div class="text-xs text-[#a0a0a0]">Урон: +15</div>
                        </div>
                    </div>
                    <button onclick="market.buySword('stone')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        15,000 <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Metal Sword -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-blue-400">
                            <i class="fas fa-khanda text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Металлический меч</div>
                            <div class="text-xs text-[#a0a0a0]">Урон: +25</div>
                        </div>
                    </div>
                    <button onclick="market.buySword('metal')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-emerald-400 rounded hover:border-emerald-400">
                        200 <i class="far fa-gem text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Steel Sword -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-cyan-400">
                            <i class="fas fa-sword text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Стальной меч</div>
                            <div class="text-xs text-[#a0a0a0]">Урон: +40</div>
                        </div>
                    </div>
                    <button onclick="market.buySword('steel')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-emerald-400 rounded hover:border-emerald-400">
                        500 <i class="far fa-gem text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Silver Master Sword -->
                <div class="panel p-3 rounded flex items-center justify-between border-purple-900/50 bg-purple-900/10">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-purple-500 rounded flex items-center justify-center text-purple-300">
                            <i class="fas fa-wand-magic-sparkles text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-purple-200 font-serif">Серебряный меч мастера</div>
                            <div class="text-xs text-purple-400">Урон: +60</div>
                        </div>
                    </div>
                    <button onclick="market.buySword('silver')" class="bg-[#111] border border-purple-500 px-3 py-1.5 text-xs text-emerald-400 rounded hover:border-purple-400">
                        1,500 <i class="far fa-gem text-[10px]"></i>
                    </button>
                </div>
            </div>

            <!-- Content: Armor -->
            <div id="market-armor" class="hidden space-y-3">
                <!-- Leather Armor -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-amber-700">
                            <i class="fas fa-vest text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Кожаная броня</div>
                            <div class="text-xs text-[#a0a0a0]">Броня: +5</div>
                        </div>
                    </div>
                    <button onclick="market.buyArmor('leather')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        10,000 <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Improved Leather -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-amber-600">
                            <i class="fas fa-vest-patches text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Улучшенная кожаная броня</div>
                            <div class="text-xs text-[#a0a0a0]">Броня: +15</div>
                        </div>
                    </div>
                    <button onclick="market.buyArmor('improved')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-[#c8aa6e] rounded hover:border-[#c8aa6e]">
                        30,000 <i class="fas fa-coins text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Chainmail -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-gray-400">
                            <i class="fas fa-user-shield text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Кольчужная броня</div>
                            <div class="text-xs text-[#a0a0a0]">Броня: +25</div>
                        </div>
                    </div>
                    <button onclick="market.buyArmor('chainmail')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-emerald-400 rounded hover:border-emerald-400">
                        200 <i class="far fa-gem text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Iron Armor -->
                <div class="panel p-3 rounded flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-[#333] rounded flex items-center justify-center text-blue-300">
                            <i class="fas fa-shield text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-[#e0e0e0] font-serif">Железная броня</div>
                            <div class="text-xs text-[#a0a0a0]">Броня: +40</div>
                        </div>
                    </div>
                    <button onclick="market.buyArmor('iron')" class="bg-[#111] border border-[#333] px-3 py-1.5 text-xs text-emerald-400 rounded hover:border-emerald-400">
                        600 <i class="far fa-gem text-[10px]"></i>
                    </button>
                </div>
                
                <!-- Silver Master Armor -->
                <div class="panel p-3 rounded flex items-center justify-between border-purple-900/50 bg-purple-900/10">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-[#222] border border-purple-500 rounded flex items-center justify-center text-purple-300">
                            <i class="fas fa-shield-halved text-2xl"></i>
                        </div>
                        <div>
                            <div class="text-purple-200 font-serif">Серебряная броня мастера</div>
                            <div class="text-xs text-purple-400">Броня: +60</div>
                        </div>
                    </div>
                    <button onclick="market.buyArmor('silver_master')" class="bg-[#111] border border-purple-500 px-3 py-1.5 text-xs text-emerald-400 rounded hover:border-purple-400">
                        1,200 <i class="far fa-gem text-[10px]"></i>
                    </button>
                </div>
            </div>

            <!-- Content: Placeholders -->
            <div id="market-placeholder" class="hidden flex flex-col items-center justify-center py-10 opacity-50">
                <i class="fas fa-dungeon text-4xl mb-3 text-gray-600"></i>
                <p class="text-sm text-gray-500">Этот торговец еще не прибыл в город.</p>
            </div>

            <!-- Resources Trade -->
            <div class="panel rounded-lg p-4 mt-4">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="medieval-font text-sm text-[#c8aa6e]">Материалы</h3>
                    <div class="flex gap-2">
                        <button onclick="market.switchTradeMode('sell')" id="market-trade-sell" class="sub-tab active">Продажа</button>
                        <button onclick="market.switchTradeMode('buy')" id="market-trade-buy" class="sub-tab">Покупка</button>
                    </div>
                </div>

                <div id="market-trade-grid" class="grid grid-cols-2 gap-3">
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-blue-900/30 bg-blue-900/10">
                        <i class="fas fa-fish text-[#c8aa6e] mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Рыба</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-fish">5</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-fish">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-fish" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('fish')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('fish')" id="btn-trade-fish" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-yellow-900/30 bg-yellow-900/10">
                        <i class="fas fa-wheat-awn text-[#c8aa6e] mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Пшеница</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-wheat">15</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-wheat">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-wheat" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('wheat')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('wheat')" id="btn-trade-wheat" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-gray-700/30 bg-gray-700/10">
                        <i class="fas fa-cube text-[#c8aa6e] mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Руда</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-ore">40</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-ore">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-ore" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('ore')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('ore')" id="btn-trade-ore" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-red-900/30 bg-red-900/10">
                        <i class="fas fa-scroll text-[#c8aa6e] mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Кожа</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-leather">100</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-leather">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-leather" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('leather')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('leather')" id="btn-trade-leather" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-amber-900/30 bg-amber-900/10">
                        <i class="fas fa-tree text-[#c8aa6e] mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Палки</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-wood">5</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-wood">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-wood" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('wood')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('wood')" id="btn-trade-wood" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-gray-600/30 bg-gray-600/10">
                        <i class="fas fa-shapes text-gray-400 mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Камни</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-stone">5</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-stone">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-stone" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('stone')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('stone')" id="btn-trade-stone" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-green-900/30 bg-green-900/10">
                        <i class="fas fa-leaf text-green-400 mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Травы</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-herbs">10</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-herbs">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-herbs" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('herbs')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('herbs')" id="btn-trade-herbs" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                    <div class="panel p-2 rounded flex flex-col items-center text-center border-purple-900/30 bg-purple-900/10">
                        <i class="fas fa-spider text-purple-400 mb-1"></i>
                        <div class="text-xs text-[#e0e0e0]">Грибы</div>
                        <div class="text-[10px] text-[#a0a0a0] mb-1"><span id="price-mushrooms">25</span> <i class="fas fa-coins"></i></div>
                        <div class="text-[10px] text-blue-300 mb-1">У вас: <span id="market-count-mushrooms">0</span></div>
                        <div class="flex gap-1 w-full mb-1">
                            <input id="trade-input-mushrooms" type="number" min="1" value="1" class="w-full bg-[#111] border border-[#333] text-center text-[10px] text-white rounded p-0 outline-none focus:border-[#c8aa6e]">
                            <button onclick="market.setMax('mushrooms')" class="w-auto px-2 bg-[#222] border border-[#444] rounded text-[10px] text-gray-400 hover:text-white">Max</button>
                        </div>
                        <button onclick="market.sellFromInput('mushrooms')" id="btn-trade-mushrooms" class="w-full bg-[#2c2c30] border border-[#c8aa6e] rounded text-[10px] py-1 text-[#c8aa6e] hover:bg-[#c8aa6e] hover:text-black transition-colors uppercase">Продать</button>
                    </div>
                </div>
            </div>

        </section>

        <!-- VIEW: LIVESTOCK TRADER -->
        <section id="view-livestock-trader" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-emerald-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(16,185,129,0.18),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-emerald-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-emerald-900/50 bg-black/30 flex items-center justify-center text-emerald-400 hover:bg-emerald-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-900/60 to-emerald-950 flex items-center justify-center border-2 border-emerald-500/60 shadow-[0_0_15px_rgba(16,185,129,0.35)]">
                        <i class="fas fa-cow text-emerald-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-emerald-300 drop-shadow-md">Торговец скотом</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4">
                <div class="panel p-3 rounded flex items-center justify-between border-emerald-900/30 bg-emerald-900/10">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full border border-emerald-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-hat-cowboy text-emerald-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Фермер Хью</div>
                            <div class="text-[10px] text-[#a0a0a0]">Торговец скотом</div>
                        </div>
                    </div>
                    <button onclick="ui.showFloatText(this, 'Кормлю людей... и зверей', '#34d399')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>

                <div class="panel p-3 rounded bg-black/20 border border-[#333] text-[10px] text-[#a0a0a0]">
                    <div class="text-[10px] text-emerald-400 font-bold uppercase tracking-widest mb-1">Важно</div>
                    Купить животных можно только если у тебя есть <span class="text-[#c8aa6e] font-bold">дом</span> с загоном для животных.
                </div>

                <div class="space-y-3">
                    <h3 class="text-xs text-[#777] uppercase border-b border-[#333] pb-1">Животные</h3>

                    <div class="border border-[#333] rounded p-3 bg-black/20">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-3">
                                <i class="fas fa-rabbit text-emerald-300 text-lg mt-1"></i>
                                <div>
                                    <div class="text-sm font-bold text-[#e0e0e0]">Кролик</div>
                                    <div class="text-[10px] text-[#777]">Для хозяйства. Ест овощи.</div>
                                </div>
                            </div>
                            <div class="text-sm text-yellow-400 font-bold">4,000 <i class="fas fa-coins"></i></div>
                        </div>
                        <button onclick="livestock.buyAnimal('rabbit')" class="btn-medieval w-full py-1.5 rounded text-[10px]">Купить</button>
                    </div>

                    <div class="border border-[#333] rounded p-3 bg-black/20">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-3">
                                <i class="fas fa-kiwi-bird text-amber-300 text-lg mt-1"></i>
                                <div>
                                    <div class="text-sm font-bold text-[#e0e0e0]">Курица</div>
                                    <div class="text-[10px] text-[#777]">Несёт яйца. Ест зерно.</div>
                                </div>
                            </div>
                            <div class="text-sm text-yellow-400 font-bold">5,000 <i class="fas fa-coins"></i></div>
                        </div>
                        <button onclick="livestock.buyAnimal('chicken')" class="btn-medieval w-full py-1.5 rounded text-[10px]">Купить</button>
                    </div>

                    <div class="border border-[#333] rounded p-3 bg-black/20">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-3">
                                <i class="fas fa-piggy-bank text-pink-300 text-lg mt-1"></i>
                                <div>
                                    <div class="text-sm font-bold text-[#e0e0e0]">Свинья</div>
                                    <div class="text-[10px] text-[#777]">Даёт мясо. Ест овощи.</div>
                                </div>
                            </div>
                            <div class="text-sm text-yellow-400 font-bold">10,000 <i class="fas fa-coins"></i></div>
                        </div>
                        <button onclick="livestock.buyAnimal('pig')" class="btn-medieval w-full py-1.5 rounded text-[10px]">Купить</button>
                    </div>

                    <div class="border border-[#333] rounded p-3 bg-black/20">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-3">
                                <i class="fas fa-cow text-white text-lg mt-1"></i>
                                <div>
                                    <div class="text-sm font-bold text-[#e0e0e0]">Корова</div>
                                    <div class="text-[10px] text-[#777]">Даёт молоко. Ест сено.</div>
                                </div>
                            </div>
                            <div class="text-sm text-yellow-400 font-bold">50,000 <i class="fas fa-coins"></i></div>
                        </div>
                        <button onclick="livestock.buyAnimal('cow')" class="btn-medieval w-full py-1.5 rounded text-[10px]">Купить</button>
                    </div>
                </div>

                <div class="space-y-3">
                    <h3 class="text-xs text-[#777] uppercase border-b border-[#333] pb-1">Корм</h3>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="livestock.buyFeed('grain')" class="panel p-2 rounded bg-black/20 border border-[#333] text-center">
                            <i class="fas fa-wheat-awn text-amber-300"></i>
                            <div class="text-[10px] text-[#e0e0e0] mt-1">Зерно</div>
                            <div class="text-[10px] text-yellow-500">20 <i class="fas fa-coins"></i></div>
                        </button>
                        <button onclick="livestock.buyFeed('hay')" class="panel p-2 rounded bg-black/20 border border-[#333] text-center">
                            <i class="fas fa-seedling text-green-300"></i>
                            <div class="text-[10px] text-[#e0e0e0] mt-1">Сено</div>
                            <div class="text-[10px] text-yellow-500">30 <i class="fas fa-coins"></i></div>
                        </button>
                        <button onclick="livestock.buyFeed('vegetables')" class="panel p-2 rounded bg-black/20 border border-[#333] text-center">
                            <i class="fas fa-carrot text-orange-300"></i>
                            <div class="text-[10px] text-[#e0e0e0] mt-1">Овощи</div>
                            <div class="text-[10px] text-yellow-500">15 <i class="fas fa-coins"></i></div>
                        </button>
                    </div>
                    <p class="text-[10px] text-[#777]">Корм добавляется в инвентарь как ресурс и имеет вес.</p>
                </div>
            </div>
        </section>

        <!-- VIEW: VILLAGE -->
        <section id="view-village" class="hidden space-y-4">
            <div class="loc-hero h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-[#0b2b17]/85 via-[#1a1a1d] to-[#0f0f10]" data-loc="village" style="--hero-img: none;">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(0,128,0,0.25),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#008000]/60 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-[#008000]/40 bg-black/30 flex items-center justify-center text-[#7ad37a] hover:bg-[#008000]/20 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#0f4a26]/70 to-[#0b2b17] flex items-center justify-center border-2 border-[#008000]/60 shadow-[0_0_15px_rgba(0,128,0,0.35)]">
                        <i class="fas fa-house-chimney text-[#3ddc84] text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-[#def7de] drop-shadow-md">Деревня на окраине</h2>
                </div>
            </div>

            <!-- Disease Warning -->
            <div id="measles-warning" class="hidden panel p-3 rounded border-red-500 bg-red-900/20 flex items-center gap-3">
                <i class="fas fa-virus text-red-500 text-xl animate-pulse"></i>
                <div>
                    <div class="text-sm text-red-400 font-bold">Корь!</div>
                    <div class="text-[10px] text-gray-400">-1 HP каждые 20 сек. Посетите мудреца.</div>
                </div>
            </div>

            <!-- Your House -->
            <div class="panel rounded-lg p-4 space-y-3">
                <div class="flex items-center justify-between">
                    <h3 class="medieval-font text-lg text-[#c8aa6e]"><i class="fas fa-home mr-2"></i>Ваш Дом</h3>
                    <span id="house-status" class="text-[10px] text-red-400">Не куплен</span>
                </div>
                
                <div id="house-not-owned" class="text-center py-4">
                    <i class="fas fa-house-circle-xmark text-4xl text-gray-600 mb-2"></i>
                    <p class="text-xs text-gray-400 mb-3">Купите дом, чтобы хранить вещи и заниматься хозяйством.</p>
                    <button onclick="village.buyHouse()" class="btn-medieval w-full py-2 rounded text-sm">
                        Купить дом <span class="text-emerald-400">1000 <i class="far fa-gem"></i></span>
                    </button>
                </div>

                <div id="house-owned" class="hidden space-y-3">
                    <!-- Storage -->
                    <div class="border border-[#333] rounded p-2 bg-black/20">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-box text-amber-500"></i>
                            <span class="text-xs text-[#e0e0e0]">Хранилище</span>
                        </div>
                        <p class="text-[10px] text-gray-500">Здесь можно хранить ненужные вещи (в разработке)</p>
                    </div>

                    <!-- Workbench -->
                    <div class="border border-[#333] rounded p-2 bg-black/20">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-gavel text-blue-400"></i>
                            <span class="text-xs text-[#e0e0e0]">Верстак</span>
                        </div>
                        <p class="text-[10px] text-gray-500">Создавайте новые предметы (в разработке)</p>
                    </div>

                    <!-- Pig Pen -->
                    <div class="border border-[#333] rounded p-2 bg-black/20">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-piggy-bank text-pink-400"></i>
                                <span class="text-xs text-[#e0e0e0]">Свинарник (Ур <span id="pig-pen-level">0</span>)</span>
                            </div>
                            <span class="text-[10px] text-gray-400">Мясо: <span id="meat-count">0</span></span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="village.upgradePigPen()" class="flex-1 bg-[#222] border border-pink-500 text-pink-400 py-1 rounded text-[10px] hover:bg-pink-900/30">
                                Улучшить (100 <i class="fas fa-coins"></i>)
                            </button>
                            <button onclick="village.collectMeat()" class="flex-1 bg-[#222] border border-[#c8aa6e] text-[#c8aa6e] py-1 rounded text-[10px] hover:bg-[#c8aa6e]/20">
                                Собрать мясо
                            </button>
                        </div>
                    </div>

                    <!-- Stable -->
                    <div class="border border-[#333] rounded p-2 bg-black/20">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-horse text-amber-600"></i>
                            <span class="text-xs text-[#e0e0e0]">Конюшня</span>
                        </div>
                        <p class="text-[10px] text-gray-500" id="stable-status">Пусто. Купите коня на рынке.</p>
                    </div>
                </div>
            </div>

            <!-- Sage's House -->
            <div class="panel rounded-lg p-4 space-y-3">
                <h3 class="medieval-font text-lg text-indigo-400"><i class="fas fa-hat-wizard mr-2"></i>Дом Мудреца</h3>
                
                <!-- Sage NPC -->
                <div class="flex items-center justify-between p-2 bg-indigo-900/20 rounded border border-indigo-900/30">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full border border-indigo-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-hat-wizard text-indigo-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Мудрец Эльдар</div>
                            <div class="text-[10px] text-[#a0a0a0]">Хранитель знаний</div>
                        </div>
                    </div>
                    <button onclick="dialogue.start('sage')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>

                <!-- Cure Measles -->
                <div id="cure-measles-section" class="hidden border border-red-900/50 rounded p-3 bg-red-900/10">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-flask text-red-400"></i>
                        <span class="text-sm text-red-400 font-bold">Лечение от Кори</span>
                    </div>
                    <p class="text-[10px] text-gray-400 mb-2">Мудрец может исцелить вас от страшной болезни.</p>
                    <div class="flex items-center gap-2 text-[10px] text-gray-500 mb-2">
                        <span>Требуется:</span>
                        <span class="text-green-400">15 <i class="fas fa-leaf"></i> Трав</span>
                        <span class="text-purple-400">10 <i class="fas fa-spider"></i> Грибов</span>
                    </div>
                    <button onclick="village.cureMeasles()" class="btn-medieval w-full py-2 rounded text-xs border-red-500 text-red-400">
                        Исцелиться
                    </button>
                </div>

                <!-- Sage's Recipes -->
                <div class="space-y-2">
                    <div class="text-xs text-gray-400 border-b border-[#333] pb-1">Рецепты от Мудреца</div>
                    
                    <div class="border border-[#333] rounded p-2 bg-black/20 flex justify-between items-center">
                        <div class="flex gap-2">
                            <i class="fas fa-scroll text-yellow-400"></i>
                            <div>
                                <div class="text-xs text-[#e0e0e0]">Рецепт: Зелье Силы</div>
                                <div class="text-[10px] text-gray-500">+10 к урону на 5 мин</div>
                            </div>
                        </div>
                        <button class="bg-[#222] border border-[#c8aa6e] text-[#c8aa6e] px-2 py-1 rounded text-[10px]">
                            200 <i class="far fa-gem"></i>
                        </button>
                    </div>

                    <div class="border border-[#333] rounded p-2 bg-black/20 flex justify-between items-center">
                        <div class="flex gap-2">
                            <i class="fas fa-scroll text-cyan-400"></i>
                            <div>
                                <div class="text-xs text-[#e0e0e0]">Рецепт: Зелье Скорости</div>
                                <div class="text-[10px] text-gray-500">+50% скорость работы</div>
                            </div>
                        </div>
                        <button class="bg-[#222] border border-[#c8aa6e] text-[#c8aa6e] px-2 py-1 rounded text-[10px]">
                            150 <i class="far fa-gem"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Fresh Bread Stall -->
            <div class="panel rounded-lg p-4 space-y-3">
                <div class="flex items-center justify-between">
                    <h3 class="medieval-font text-lg text-amber-300"><i class="fas fa-bread-slice mr-2"></i>Ларёк со свежим хлебом</h3>
                </div>
                
                <div class="panel p-3 rounded bg-amber-900/10 border border-amber-700/30">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-bread-slice text-4xl text-amber-400"></i>
                            <div>
                                <div class="text-sm text-[#e0e0e0] font-bold">Свежий хлеб</div>
                                <div class="text-[10px] text-gray-400">Восстанавливает 20% голода</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 mb-3 text-sm">
                        <span class="text-yellow-500">Цена: 20 <i class="fas fa-coins"></i></span>
                    </div>
                    <button onclick="village.buyBread(event)" class="btn-medieval w-full py-2 rounded text-sm">
                        Купить хлеб
                    </button>
                </div>
            </div>
        </section>

        <!-- VIEW: TRAINING CAMP -->
        <section id="view-training-camp" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-red-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(220,38,38,0.2),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-red-600/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-red-900/50 bg-black/30 flex items-center justify-center text-red-400 hover:bg-red-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-red-800/60 to-red-950 flex items-center justify-center border-2 border-red-600/60 shadow-[0_0_15px_rgba(220,38,38,0.3)]">
                        <i class="fas fa-shield-halved text-red-500 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-red-300 drop-shadow-md">Учебный Лагерь</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4 text-center">
                 <p class="text-sm text-[#e0e0e0]">Здесь тренируются лучшие воины королевства.</p>

                 <!-- John NPC -->
                <div class="panel p-3 rounded flex items-center justify-between border-red-900/30 bg-red-900/10 text-left">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full border border-red-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-user-shield text-red-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Рыцарь Джон</div>
                            <div class="text-[10px] text-[#a0a0a0]">Наставник</div>
                        </div>
                    </div>
                    <button onclick="dialogue.start('john')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>
                
                <div class="p-4 border border-[#333] rounded bg-black/20">
                    <i class="fas fa-dumbbell text-3xl text-gray-600 mb-2"></i>
                    <p class="text-xs text-gray-500">Тренировки временно недоступны.</p>
                </div>
            </div>
        </section>

        <!-- VIEW: MILITARY FORTRESS -->
        <section id="view-military-fortress" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-slate-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(148,163,184,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-slate-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-slate-700/50 bg-black/30 flex items-center justify-center text-slate-300 hover:bg-slate-800/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-slate-800/60 to-slate-950 flex items-center justify-center border-2 border-slate-500/60 shadow-[0_0_15px_rgba(148,163,184,0.25)]">
                        <i class="fas fa-tower-observation text-slate-300 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-slate-200 drop-shadow-md">Военная Крепость</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4">
                <div class="text-center text-xs text-[#777] bg-black/20 border border-[#333] rounded p-3">
                    За высокими стенами — железная дисциплина, оружейные склады и элитные отряды королевства.
                </div>

                <div class="panel p-3 rounded flex items-center justify-between border-slate-600/30 bg-slate-900/10">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full border border-slate-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-shield-halved text-slate-300"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Капрал</div>
                            <div class="text-[10px] text-[#a0a0a0]">Страж крепости</div>
                        </div>
                    </div>
                    <button onclick="dialogue.start('fortress_guard')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>

                <div class="panel p-3 rounded bg-black/20 border border-[#333] text-[10px] text-[#a0a0a0]">
                    <div class="text-[10px] text-slate-300 font-bold uppercase tracking-widest mb-1">Пропуск</div>
                    Вход сюда разрешён только тем, кто прошёл подготовку в Учебном лагере.
                </div>
            </div>
        </section>

        <!-- VIEW: ROYAL CASTLE -->
        <section id="view-royal-castle" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-indigo-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(99,102,241,0.2),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-indigo-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-indigo-900/50 bg-black/30 flex items-center justify-center text-indigo-400 hover:bg-indigo-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-900/60 to-indigo-950 flex items-center justify-center border-2 border-indigo-500/60 shadow-[0_0_15px_rgba(99,102,241,0.3)]">
                        <i class="fas fa-chess-rook text-indigo-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-indigo-300 drop-shadow-md">Королевский замок</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4">
                <div class="flex items-center justify-between p-3 bg-purple-900/10 rounded border border-purple-900/30">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full border border-purple-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-shield text-purple-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Стражник</div>
                            <div class="text-[10px] text-[#a0a0a0]">Королевская стража</div>
                        </div>
                    </div>
                    <button onclick="dialogue.start('castle_guard')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>

                <div class="text-center text-xs text-[#777] bg-black/20 border border-[#333] rounded p-3">
                    Вход в замок закрыт для простолюдинов.
                </div>
            </div>
        </section>

        <!-- VIEW: POOR DISTRICT -->
        <section id="view-poor-district" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-stone-900/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(120,113,108,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-stone-600/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-stone-700/50 bg-black/30 flex items-center justify-center text-stone-400 hover:bg-stone-800/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-stone-800/60 to-stone-950 flex items-center justify-center border-2 border-stone-600/60 shadow-[0_0_15px_rgba(120,113,108,0.2)]">
                        <i class="fas fa-house-crack text-stone-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-stone-300 drop-shadow-md">Район для бедняков</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4">
                <div class="text-center text-xs text-[#777] bg-black/20 border border-[#333] rounded p-3">
                    Узкие грязные улочки, старые лачуги и отчаянные люди. Здесь выживают, а не живут.
                </div>

                <div class="panel p-3 rounded flex items-center justify-between border-gray-700/30 bg-gray-900/20">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full border border-gray-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-hand-holding-medical text-gray-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Старый нищий</div>
                            <div class="text-[10px] text-[#a0a0a0]">Проситель</div>
                        </div>
                    </div>
                    <button class="btn-medieval px-4 py-1.5 rounded text-xs" onclick="ui.showFloatText(this, 'Скоро...', '#777')">Говорить</button>
                </div>

                <!-- Poor House Section -->
                <div class="panel rounded p-3 space-y-3 border-t border-[#333] bg-black/10">
                    <h3 class="medieval-font text-sm text-gray-400"><i class="fas fa-home mr-2"></i>Старый Дом</h3>
                    
                    <div id="poor-house-buy" class="text-center py-2">
                        <p class="text-xs text-gray-500 mb-2">Ветхая лачуга, но крыша не течёт. Есть хранилище, верстак и печь.</p>
                        <button onclick="housing.buyPoorHouse()" class="btn-medieval w-full py-2 rounded text-sm text-gray-300 border-gray-600">
                            Купить (500 <i class="far fa-gem text-emerald-400"></i>)
                        </button>
                    </div>

                    <div id="poor-house-owned" class="hidden grid grid-cols-3 gap-2">
                        <div class="panel p-2 rounded flex flex-col items-center text-center bg-black/20">
                            <i class="fas fa-box text-amber-700 mb-1"></i>
                            <div class="text-[10px] text-gray-400">Склад</div>
                        </div>
                        <div class="panel p-2 rounded flex flex-col items-center text-center bg-black/20">
                            <i class="fas fa-hammer text-gray-500 mb-1"></i>
                            <div class="text-[10px] text-gray-400">Верстак</div>
                        </div>
                        <div class="panel p-2 rounded flex flex-col items-center text-center bg-black/20">
                            <i class="fas fa-fire text-orange-600 mb-1"></i>
                            <div class="text-[10px] text-gray-400">Печь</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: NOBLE QUARTER -->
        <section id="view-noble-quarter" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-yellow-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(234,179,8,0.2),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-yellow-900/50 bg-black/30 flex items-center justify-center text-yellow-400 hover:bg-yellow-900/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-yellow-900/60 to-yellow-950 flex items-center justify-center border-2 border-yellow-500/60 shadow-[0_0_15px_rgba(234,179,8,0.3)]">
                        <i class="fas fa-crown text-yellow-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-yellow-300 drop-shadow-md">Дворянский квартал</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4">
                <div class="text-center text-xs text-[#777] bg-black/20 border border-[#333] rounded p-3">
                    Мраморные особняки, золотые ворота и надменные взгляды. Здесь правит власть и честь.
                </div>
                <div class="panel p-3 rounded flex items-center justify-between border-yellow-900/30 bg-yellow-900/10">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full border border-yellow-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-user-tie text-yellow-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Советник</div>
                            <div class="text-[10px] text-[#a0a0a0]">Дворянин</div>
                        </div>
                    </div>
                    <button class="btn-medieval px-4 py-1.5 rounded text-xs" onclick="ui.showFloatText(this, 'Скоро...', '#c8aa6e')">Говорить</button>
                </div>

                <!-- Noble House Section -->
                <div class="panel rounded p-3 space-y-3 border-t border-yellow-600/30">
                    <h3 class="medieval-font text-sm text-yellow-500"><i class="fas fa-landmark mr-2"></i>Роскошный Особняк</h3>
                    
                    <div id="noble-house-buy" class="text-center py-2">
                        <p class="text-xs text-yellow-700/70 mb-2">Дом для истинной знати. Галерея, конюшня, оружейная.</p>
                        <button onclick="housing.buyNobleHouse()" class="btn-medieval w-full py-2 rounded text-sm text-yellow-200 border-yellow-600 bg-yellow-900/20">
                            Купить (10,000 <i class="far fa-gem text-emerald-400"></i>)
                        </button>
                    </div>

                    <div id="noble-house-owned" class="hidden space-y-2">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="panel p-2 rounded flex items-center gap-2 bg-black/30 border border-yellow-900/30">
                                <i class="fas fa-palette text-pink-400"></i>
                                <div class="text-[10px] text-gray-300">Галерея Искусств</div>
                            </div>
                            <div class="panel p-2 rounded flex items-center gap-2 bg-black/30 border border-yellow-900/30">
                                <i class="fas fa-shield-halved text-gray-300"></i>
                                <div class="text-[10px] text-gray-300">Оружейная</div>
                            </div>
                            <div class="panel p-2 rounded flex items-center gap-2 bg-black/30 border border-yellow-900/30">
                                <i class="fas fa-horse-head text-amber-600"></i>
                                <div class="text-[10px] text-gray-300">Конюшня (2 места)</div>
                            </div>
                            <div class="panel p-2 rounded flex items-center gap-2 bg-black/30 border border-yellow-900/30">
                                <i class="fas fa-wine-glass text-purple-500"></i>
                                <div class="text-[10px] text-gray-300">Виноградник</div>
                            </div>
                        </div>
                        <div class="panel p-2 rounded flex items-center justify-between bg-black/30 border border-yellow-900/30">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-cow text-white"></i>
                                <div class="text-[10px] text-gray-300">Хозяйство</div>
                            </div>
                            <span class="text-[10px] text-yellow-600">Ур. 1</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW: REFUGEE CAMP -->
        <section id="view-refugee-camp" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-slate-900/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(100,116,139,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-slate-600/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-slate-700/50 bg-black/30 flex items-center justify-center text-slate-400 hover:bg-slate-800/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-slate-800/60 to-slate-950 flex items-center justify-center border-2 border-slate-600/60 shadow-[0_0_15px_rgba(100,116,139,0.2)]">
                        <i class="fas fa-campground text-slate-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-slate-300 drop-shadow-md">Лагерь беженцев</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4">
                <div class="text-center text-xs text-[#777] bg-black/20 border border-[#333] rounded p-3">
                    Палатки из тряпья, потухшие костры и тихие разговоры о лучшей жизни за границей.
                </div>

                <div class="panel p-3 rounded flex items-center justify-between border-gray-600/30 bg-gray-800/10">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full border border-gray-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-user-secret text-gray-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Томас</div>
                            <div class="text-[10px] text-[#a0a0a0]">Перевозчик</div>
                        </div>
                    </div>
                    <button onclick="dialogue.start('thomas')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>
            </div>
        </section>

        <!-- VIEW: REFUGEE CAMP -->
        <section id="view-refugee-camp" class="hidden space-y-4">
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-slate-900/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(100,116,139,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-slate-600/50 to-transparent"></div>
                <div class="absolute top-4 left-4">
                    <button onclick="router.navigate('map')" class="w-8 h-8 rounded border border-slate-700/50 bg-black/30 flex items-center justify-center text-slate-400 hover:bg-slate-800/30 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                <div class="absolute top-1/2 left-16 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-slate-800/60 to-slate-950 flex items-center justify-center border-2 border-slate-600/60 shadow-[0_0_15px_rgba(100,116,139,0.2)]">
                        <i class="fas fa-campground text-slate-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-slate-300 drop-shadow-md">Лагерь беженцев</h2>
                </div>
            </div>

            <div class="panel rounded-lg p-4 space-y-4">
                <div class="text-center text-xs text-[#777] bg-black/20 border border-[#333] rounded p-3">
                    Палатки из тряпья, потухшие костры и тихие разговоры о лучшей жизни за границей.
                </div>

                <div class="panel p-3 rounded flex items-center justify-between border-gray-600/30 bg-gray-800/10">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full border border-gray-500 bg-[#222] flex items-center justify-center">
                            <i class="fas fa-user-secret text-gray-400"></i>
                        </div>
                        <div>
                            <div class="text-sm text-[#e0e0e0] font-bold">Томас</div>
                            <div class="text-[10px] text-[#a0a0a0]">Перевозчик</div>
                        </div>
                    </div>
                    <button onclick="dialogue.start('thomas')" class="btn-medieval px-4 py-1.5 rounded text-xs">
                        Говорить
                    </button>
                </div>
            </div>
        </section>

        <!-- VIEW: QUESTS -->
        <section id="view-quests" class="hidden space-y-4">
            <!-- Quests Header -->
            <div class="h-20 w-full relative rounded-lg mb-4 overflow-hidden bg-gradient-to-br from-amber-950/80 via-[#1a1a1d] to-[#0f0f10]">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_30%,rgba(217,119,6,0.15),transparent_60%)]"></div>
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-900/60 to-amber-950 flex items-center justify-center border-2 border-amber-500/60 shadow-[0_0_15px_rgba(217,119,6,0.3)]">
                        <i class="fas fa-scroll text-amber-400 text-lg"></i>
                    </div>
                    <h2 class="medieval-font text-2xl text-amber-300 drop-shadow-md">Задания</h2>
                </div>
            </div>
             
             <!-- Quest Tabs -->
             <div class="flex items-center justify-center gap-2 overflow-x-auto pb-2 mb-4 no-scrollbar">
                <button onclick="quests.switchTab('daily')" id="tab-quests-daily" class="sub-tab active">Ежедневные</button>
                <button onclick="quests.switchTab('character')" id="tab-quests-character" class="sub-tab">Персонажи</button>
            </div>

            <div id="quests-list" class="space-y-3 pb-20">
                <!-- Quests populated by JS -->
            </div>
        </section>

    </main>

    <!-- Bottom Navigation -->
    <nav class="h-16 bg-[#141417] border-t border-[#333] flex justify-around items-center z-30 shrink-0 shadow-[0_-5px_15px_rgba(0,0,0,0.5)]">
        <button onclick="router.switchTab('map')" class="nav-item flex-1 flex flex-col items-center justify-center h-full text-[#777] hover:text-[#c8aa6e] transition-colors" id="nav-map">
            <i class="fas fa-map-marked-alt mb-1 text-lg"></i>
            <span class="text-[10px] uppercase tracking-wider font-serif">Карта</span>
        </button>
        <button onclick="router.switchTab('market')" class="nav-item flex-1 flex flex-col items-center justify-center h-full text-[#777] hover:text-[#c8aa6e] transition-colors" id="nav-market">
            <i class="fas fa-shopping-bag mb-1 text-lg"></i>
            <span class="text-[10px] uppercase tracking-wider font-serif">Рынок</span>
        </button>
        <button onclick="router.switchTab('quests')" class="nav-item flex-1 flex flex-col items-center justify-center h-full text-[#777] hover:text-[#c8aa6e] transition-colors" id="nav-quests">
            <i class="fas fa-scroll mb-1 text-lg"></i>
            <span class="text-[10px] uppercase tracking-wider font-serif">Задания</span>
        </button>
        <button onclick="router.switchTab('character')" class="nav-item active flex-1 flex flex-col items-center justify-center h-full text-[#777] hover:text-[#c8aa6e] transition-colors" id="nav-character">
            <i class="fas fa-user-shield mb-1 text-lg"></i>
            <span class="text-[10px] uppercase tracking-wider font-serif">Герой</span>
        </button>
    </nav>


    <!-- Game Script -->
    <script src="game.js"></script>
</body>
</html>
